# Javascript æ‰¿è¯ºåŠ¨ç”»åºåˆ—

> åŸæ–‡ï¼š<https://medium.com/hackernoon/javascript-promises-for-animation-sequences-e31873493d49>

![](img/16080254c885590cb261629d453cb13a.png)

æˆ‘æœ€è¿‘æœ‰æœºä¼šå‚åŠ äº†ä»¤äººæƒŠå¹çš„ [creativecoding.club](http://creativecoding.club) å¹¶æ‹¼å‡‘äº†ä¸€ä¸ªèŠ±æœµè½åœ°çš„æ ‘çš„åŠ¨ç”»ã€‚è¿™æ£µæ ‘é¦–å…ˆä½¿ç”¨éšæœºç®—æ³•å»ºé€ (çµæ„Ÿæ¥è‡ª survivol çš„è¿™æ”¯[ç”Ÿé•¿](http://codepen.io/survivol/pen/pbGpog)ç¬”)ï¼Œç„¶åå°†èŠ±æœµéšæœºè¿æ¥åˆ°æ–°ç”Ÿé•¿çš„æ ‘çš„æ ‘ææœ«ç«¯ã€‚

ä½œä¸ºåç«¯[å·¥ç¨‹å¸ˆ](https://hackernoon.com/tagged/engineer)çš„ç»éªŒæ¯”è®¾è®¡æˆ–åŠ¨ç”»æ–¹é¢çš„ç»éªŒå¤šï¼Œæˆ‘ç«‹å³æƒ³åˆ°ä½¿ç”¨ [Javascript](https://hackernoon.com/tagged/javascript) æ‰¿è¯ºå¸®åŠ©æˆ‘æ’åºä¸€åˆ‡ï¼Œå°±åƒä¸€å †æ•°æ®åº“äº‹åŠ¡ä¸ API è°ƒç”¨äº¤é”™ã€‚å®ƒæ¶‰åŠåˆ°å¼‚æ­¥é€’å½’ï¼Œè¿™ä¸€å¼€å§‹çœ‹èµ·æ¥å¾ˆæ£˜æ‰‹ï¼Œæ‰€ä»¥æˆ‘æƒ³æˆ‘åº”è¯¥å†™ä¸€ä¸ªè§£é‡Šï¼Œä»¥é˜²å®ƒå¯èƒ½ä¼šå¸®åŠ©å…¶ä»–æƒ³ä»¥åŒæ ·çš„æ–¹å¼å°†å®ƒç”¨äºåŠ¨ç”»çš„äººã€‚ğŸ˜Š

# ç§æ¤æ ‘æœ¨

![](img/ec84fdca3c3b44c0b567cd1d7153f55d.png)

From tiny acornsâ€¦

ç¬¬ä¸€æ­¥æ˜¯å¼„æ¸…æ¥šå¦‚ä½•åˆ›å»ºéšæœºæ ‘ã€‚æˆ‘ä»¬ä½¿ç”¨é€’å½’ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ç§å¥‡ç‰¹çš„æ–¹å¼ï¼Œè¯´æ˜æˆ‘ä»¬æ˜¯åœ¨å·²ç»åšå¥½çš„å·¥ä½œçš„åŸºç¡€ä¸Šè¿›è¡Œæ„å»ºçš„ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜å±‚æ¬¡çš„æƒ³æ³•:

1.  ä»æ ‘å¹²å¼€å§‹â€”â€”æˆ‘ä»¬çŸ¥é“å®ƒçš„èµ·ç‚¹(åœ°é¢)å’Œç»ˆç‚¹(æ ‘å¹²ç¦»åœ°é¢çš„é«˜åº¦)ã€‚
2.  ç”»æ ‘å¹²ã€‚
3.  æ¥ä¸‹æ¥ï¼Œä»ä¸»å¹²ä¸Šåˆ›å»ºä¸€äº›åˆ†æ”¯â€”â€”å®ƒä»¬ä»ä¸»å¹²ç»“æŸçš„åœ°æ–¹å¼€å§‹ã€‚æˆ‘ä»¬åœ¨æ ‘å¹²çš„å·¦å³ä¸¤ä¾§éšæœºé€‰å–ä¸€äº›è§’åº¦ï¼Œä¸€äº›æ¯”æ ‘å¹²æœ¬èº«ç¨çŸ­çš„éšæœºé•¿åº¦ï¼Œå¹¶ç”¨å®ƒä»¬æ¥è®¡ç®—æ–°æ ‘æçš„æœ«ç«¯ã€‚
4.  ç”»æ ‘æã€‚
5.  å¯¹äºä¸¤ä¸ªæ–°åˆ†æ”¯ä¸­çš„æ¯ä¸€ä¸ªï¼Œæˆ‘ä»¬å–å®ƒä»¬çš„ç«¯ç‚¹ï¼Œå¹¶ä»å®ƒä»¬ä¸Šé¢å†é•¿å‡ºä¸¤ä¸ªåˆ†æ”¯ï¼Œå°±åƒæ­¥éª¤ 3 ä¸­ä¸€æ ·ã€‚
6.  é‡å¤ï¼Œç›´åˆ°æˆ‘ä»¬è¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ ‘çš„æ·±åº¦ï¼

æ‰€ä»¥è¿™ä¸ªç®—æ³•ä¼šç»™æˆ‘ä»¬ä¸€æ£µæ ‘ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¾¹èµ°è¾¹ç”»çš„è¯ï¼Œå®ƒçš„ç»˜åˆ¶é€Ÿåº¦ä¼šå’Œè®¡ç®—æœºèƒ½å¤Ÿç»˜åˆ¶å’Œè®¡ç®—çš„é€Ÿåº¦ä¸€æ ·å¿«ï¼Œå¯èƒ½å¤ªå¿«äº†ã€‚å¦‚æœæˆ‘ä»¬æƒ³ç»™æ ‘æ·»åŠ åŠ¨ç”»ï¼Œè®©å®ƒçœ‹èµ·æ¥é•¿å¾—æ›´æ…¢ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿå—¯ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªå»¶æ—¶ï¼

åœ¨æ­¥éª¤ 3 å’Œ 4 ä¹‹é—´ï¼Œè®¡ç®—ç„¶åç»˜åˆ¶æ–°çš„åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯ä»¥ç­‰å¾…(ä½¿ç”¨ setTimeout())æ¥ç»˜åˆ¶åˆ†æ”¯ã€‚ç”±äºé‡å¤å‘ç”Ÿåœ¨ç»˜åˆ¶ä¹‹åï¼Œæ‰€ä»¥æ ‘ä¼šæ…¢æ…¢æ•£å¼€ï¼Œè®¡ç®—ã€ç­‰å¾…ã€ç»˜åˆ¶ã€è®¡ç®—ã€ç­‰å¾…ã€ç»˜åˆ¶ç­‰ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬æœ€ç»ˆå¾—åˆ°çš„ä»£ç å¯èƒ½å¤§è‡´å¦‚ä¸‹æ‰€ç¤º(å‡è®¾æœªå®šä¹‰çš„å‡½æ•°åšäº†å®ƒä»¬ç›®å‰æ‰€è¯´çš„äº‹æƒ…):

# å¯»æ‰¾æœ€åä¸€ä¸ªåˆ†æ”¯çš„æœ«ç«¯

ä¸€æ—¦æˆ‘ä»¬ç§äº†æ ‘ï¼Œæˆ‘ä»¬å°±çŸ¥é“æœ€åçš„æ ‘æåœ¨å“ªé‡Œï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒä»¬éƒ½æ”¶é›†èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸‹ä¸€é˜¶æ®µç»™å®ƒä»¬åŠ ä¸ŠèŠ±ã€‚å…·ä½“æ¥è¯´ï¼Œå½“æˆ‘ä»¬æ„è¯†åˆ°æˆ‘ä»¬çš„ newRemainingBranches â‰¤ 0 æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬ä¸ä¼šå†åˆ†æ”¯ï¼Œå› æ­¤æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬è®¡ç®—çš„ç»ˆç‚¹æ˜¯ä¸€ä¸ªç»“æŸåˆ†æ”¯ã€‚

å¦‚æœæˆ‘ä»¬æ²¡æœ‰å°†æ‰€æœ‰è¿™äº›å»¶è¿Ÿæ·»åŠ åˆ°ä»£ç ä¸­ï¼Œæˆ‘ä»¬æœ¬å¯ä»¥æ‰¾åˆ°æŸç§æ–¹æ³•å°†åˆ†æ”¯çš„æœ«ç«¯è¿”å›ç»™ growTree()çš„è°ƒç”¨è€…ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æƒ³å‡ºå¦ä¸€ç§æ–¹æ³•æ¥è·å¾—æ‰€æœ‰è¿™äº›åˆ†æ”¯æœ«ç«¯â€¦

æˆ‘ä»¬å¯ä»¥å…ˆå°è¯•çš„ä¸€ç§æ–¹æ³•æ˜¯ï¼Œåˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼ŒæŠŠåˆ†æ”¯æœ«ç«¯æ”¾è¿›å»ã€‚æˆ‘ä»¬å¯ä»¥å°†æ•°ç»„ä¼ é€’ç»™ growTree()/growBranch()ï¼Œæˆ–è€…ä½¿ç”¨ä¸€ä¸ªå…¨å±€å˜é‡ã€‚ä¸ç®¡æ€æ ·ï¼Œæˆ‘ä»¬éƒ½ä¸ç¡®å®š*ä»€ä¹ˆæ—¶å€™*æ‰€æœ‰çš„åˆ†æ”¯éƒ½åœ¨æ•°ç»„ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•è®¡ç®—æˆ‘ä»¬æœŸæœ›çš„åˆ†æ”¯æ•°é‡ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦ç­‰å¾…å’ŒæŠ•ç¥¨æ¥å¾—åˆ°æ­£ç¡®çš„æ•°é‡ã€‚

å¦‚æœæˆ‘ä»¬åªæ˜¯åœ¨æ‰€æœ‰åˆ†æ”¯åˆ›å»ºæ—¶æ‰å¾—åˆ°é€šçŸ¥ï¼Œä¸æ˜¯æ›´å¥½å—ï¼Ÿ

# è¾“å…¥æ‰¿è¯º

â€œIâ€™m sorry, but Iâ€™m just thinking of the right words to sayâ€ for this section which is hard to explain

[æ‰¿è¯º](https://developers.google.com/web/fundamentals/getting-started/primers/promises)æ˜¯åšåˆ°è¿™ä¸€ç‚¹çš„å¥½æ–¹æ³•ï¼å‡è®¾æˆ‘ä»¬çš„ growTree()å‡½æ•°è¿”å›ä¸€ä¸ªæ‰¿è¯ºï¼Œæ— è®ºä½•æ—¶è®¡ç®—å¹¶ç»˜åˆ¶äº†æ‰€æœ‰çš„åˆ†æ”¯ï¼Œå®ƒéƒ½ä¼šå‘Šè¯‰æˆ‘ä»¬å¹¶ç»™æˆ‘ä»¬åˆ†æ”¯ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨è¿™äº›æ ‘ææ¥åšèŠ±çš„åŠ¨ç”»ã€‚

ç”±äº growTree()åªæ˜¯ä¸€ä¸ªå¸¦æœ‰ç‰¹æ®Šå‚æ•°çš„å¯¹ growBranch()çš„è°ƒç”¨ï¼Œå› æ­¤è®© growBranch()è¿”å›è¯¥æ‰¿è¯ºæ˜¯æœ‰æ„ä¹‰çš„ã€‚ä½†æ˜¯ growBranch()é€’å½’åœ°è°ƒç”¨è‡ªå·±ï¼Œå°½ç®¡æ˜¯ä»¥ä¸€ç§å»¶è¿Ÿçš„æ–¹å¼ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è¯´ growBranch()è¿”å›çš„æ˜¯å¯¹ä¸€ç»„ç«¯ç‚¹çš„æ‰¿è¯ºï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ„å»ºä¸€ä¸ªé€’å½’çš„æ‰¿è¯ºâ€œæ ‘â€(ç°åœ¨åœ¨è®¡ç®—æœºç§‘å­¦çš„æ„ä¹‰ä¸Š)ã€‚å½“æˆ‘ä»¬å¾—åˆ°æ‰€æœ‰è¿™äº›æ‰¿è¯ºçš„ç»“æœæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å±•å¹³ï¼Œå¾—åˆ°ä¸€ä¸ªåˆ†æ”¯ç»“å°¾çš„æ•°ç»„ã€‚

Promise åº“æœ‰å‡ ä¸ªä¸åŒçš„æ–¹é¢ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹:

*   **Promise.resolve()** æ˜¯ä¸€ä¸ªæ•ˆç”¨å‡½æ•°ï¼Œå®ƒè¯´ï¼Œâ€œæˆ‘ä¿è¯æˆ‘ä¼šç»™ä½ è¿™ä¸ªå€¼ï¼Œä½†æ˜¯ï¼Œå°±åƒï¼Œç°åœ¨ã€‚â€è¿™ä½¿å¾—æˆ‘ä»¬æ€»æ˜¯ä»å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªæ‰¿è¯ºå˜å¾—ä¸€è‡´ï¼Œæ‰€ä»¥æ— è®ºè°è°ƒç”¨å®ƒï¼ŒåŒ…æ‹¬æˆ‘ä»¬è‡ªå·±ï¼Œéƒ½å¯ä»¥è¿™æ ·å¯¹å¾…å®ƒã€‚
*   **Promise.all()** æ˜¯å¦ä¸€ä¸ªå®ç”¨ç¨‹åºï¼Œç”¨äºæ‰¿è¯ºæ‚¨å°†è¿”å›æ‚¨ä¼ é€’çš„æ‰€æœ‰æ‰¿è¯ºè§£æ(æ‚¨æ‰¿è¯ºè¿”å›çš„å®é™…å†…å®¹)çš„æ•°ç»„ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä¸€ç›´ç­‰åˆ°å‡ ä»¶äº‹æƒ…éƒ½å®Œæˆäº†ï¼Œç„¶åå°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªåŒ…è¿”å›ã€‚
*   è®©æˆ‘ä»¬ä»¥å®Œå…¨å®šåˆ¶çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰¿è¯ºã€‚å®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä½¿ç”¨ resolve()å‡½æ•°è°ƒç”¨è¯¥å‡½æ•°ã€‚å½“æ‚¨åœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨ resolve()æ—¶ï¼Œå®ƒå°†è§£æä¸ºæ‚¨ä¸º resolve()æä¾›çš„å‚æ•°ã€‚ç¬¬ä¸€æ¬¡çœ‹åˆ°å®ƒæ—¶ï¼Œå¾ˆéš¾ç†è§£ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯è¯•å›¾å°† growBranch()é€’å½’è°ƒç”¨çš„è¾“å‡ºè¿”å›ç»™çˆ¶èŠ‚ç‚¹ã€‚å¦‚æœè¿™æ²¡æœ‰æ„ä¹‰ï¼Œ [Mozilla æœ‰ä¸€ä¸ªæ›´æ¸…æ™°ã€æ›´æ·±å…¥çš„è§£é‡Š](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)ã€‚
*   **Promise.prototype.then()** è®©æˆ‘ä»¬å°†è®¡ç®—é“¾æ¥åˆ°æ‰¿è¯ºçš„æœ«å°¾ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ ‘ä¸­æ‰€æœ‰å·²è§£æçš„å€¼å±•å¹³åˆ°ç«¯ç‚¹çš„å¹³é¢æ•°ç»„ä¸­ã€‚

# æœ€ç»ˆäº§å“

æ‰€ä»¥æˆ‘å¸Œæœ›è¿™ä¸€åˆ‡éƒ½æœ‰æ„ä¹‰ï¼Œä½†æœ‰å¾ˆå¤šäº‹æƒ…æ­£åœ¨å‘ç”Ÿï¼Œæ‰€ä»¥å®ƒå¯èƒ½åªæ˜¯æœ‰åŠ©äºåˆ†å‰å’Œç©è¿™ä¸ªä»£ç ç¬”åªæœ‰æ ‘ã€‚

è¿è¡Œæ£€æŸ¥å™¨ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°è¾“å‡ºåˆ°æ§åˆ¶å°çš„æ‰€æœ‰ç«¯ç‚¹çš„æ•°ç»„ã€‚è¿™æ”¯ç¬”ä¸­çš„ä»£ç ä¸ä¸Šé¢ gists ä¸­çš„ä»£ç ç•¥æœ‰ä¸åŒï¼Œä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œæˆ‘*è¯•å›¾*ç®€åŒ–è¿™äº›ä»£ç ã€‚

æœ€åï¼Œä¸€æ—¦ä½ å¯¹ä¸Šé¢çš„æ ‘åŠ¨ç”»æœ‰æ‰€äº†è§£ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™æ”¯ç¬”ï¼Œå®ƒä½¿ç”¨æ ‘æç«¯ç‚¹æ¥ç§èŠ±:

å¦‚æœä½ æœ€ç»ˆä½¿ç”¨äº†è¿™ä¸ªæŠ€å·§ï¼Œè¯·åœ¨ Twitter [@OngEmil](https://twitter.com/OngEmil) ä¸Šä¸æˆ‘åˆ†äº«æˆ–è€…ä½œä¸ºä¸‹é¢çš„å›åº”ï¼ğŸŒ¸ğŸŒ¸ğŸŒ¸

*å¥½å§ï¼Œæˆ‘ä¸æ‰“ç®—å‘å¸ƒé‚£ä¸ª gifï¼Œé—®ä½ æ˜¯å¦å–œæ¬¢è¿™ä¸ªå¸–å­ï¼Œæ‰€ä»¥ä½œä¸ºå›æŠ¥â€¦ä½ æ„¿æ„å—*ğŸ’š*å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè¯·å…³æ³¨ï¼Ÿ:D*

[![](img/50ef4044ecd4e250b5d50f368b775d38.png)](http://bit.ly/HackernoonFB)[![](img/979d9a46439d5aebbdcdca574e21dc81.png)](https://goo.gl/k7XYbx)[![](img/2930ba6bd2c12218fdbbf7e02c8746ff.png)](https://goo.gl/4ofytp)

> [é»‘å®¢ä¸­åˆ](http://bit.ly/Hackernoon)æ˜¯é»‘å®¢å¦‚ä½•å¼€å§‹ä»–ä»¬çš„ä¸‹åˆã€‚æˆ‘ä»¬æ˜¯é˜¿å¦¹å®¶åº­çš„ä¸€å‘˜ã€‚æˆ‘ä»¬ç°åœ¨[æ¥å—æŠ•ç¨¿](http://bit.ly/hackernoonsubmission)å¹¶ä¹æ„[è®¨è®ºå¹¿å‘Š&èµåŠ©](mailto:partners@amipublications.com)çš„æœºä¼šã€‚
> 
> å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•…äº‹ï¼Œæˆ‘ä»¬æ¨èä½ é˜…è¯»æˆ‘ä»¬çš„[æœ€æ–°ç§‘æŠ€æ•…äº‹](http://bit.ly/hackernoonlatestt)å’Œ[è¶‹åŠ¿ç§‘æŠ€æ•…äº‹](https://hackernoon.com/trending)ã€‚ç›´åˆ°ä¸‹ä¸€æ¬¡ï¼Œä¸è¦æŠŠä¸–ç•Œçš„ç°å®æƒ³å½“ç„¶ï¼

![](img/be0ca55ba73a573dce11effb2ee80d56.png)