# ç”¨ Jest è¿›è¡Œ API æµ‹è¯•

> åŸæ–‡ï¼š<https://medium.com/hackernoon/api-testing-with-jest-d1ab74005c0a>

ä½¿ç”¨ Jest çš„æ¨¡ä»¿ç‰¹æ€§æµ‹è¯•å¼‚æ­¥ API è°ƒç”¨

![](img/38c8a83969b0eab074549fb7dab51a40.png)

Jest æ˜¯è„¸ä¹¦å¼€å‘çš„ä¸€ä¸ªå¾ˆæ£’çš„ JavaScript æµ‹è¯•æ¡†æ¶ã€‚å®ƒé€šå¸¸ç”¨äºæµ‹è¯• React ç»„ä»¶ï¼Œä½†å®ƒä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„é€šç”¨æµ‹è¯•æ¡†æ¶ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†ç»™å‡ºä¸€ä¸ªå¿«é€Ÿç®€å•çš„æ¼”ç¤ºï¼Œå±•ç¤ºå®ƒæµ‹è¯•å¼‚æ­¥å‡½æ•°çš„æ¨¡æ‹Ÿèƒ½åŠ›ã€‚

[**è¿™ç¯‡æ–‡ç« ä¹Ÿå‘è¡¨åœ¨æˆ‘è‡ªå·±çš„ä¸ªäººåšå®¢ä¸Šã€‚**](https://blog.koenvangilst.nl/api-testing-with-jest/)

# å˜²è®½çš„ç›®çš„

æ¨¡æ‹Ÿå¼‚æ­¥å‡½æ•°(å¦‚ API è°ƒç”¨)è€Œä¸æ˜¯ç”¨çœŸæ­£çš„ API è¿›è¡Œæµ‹è¯•æ˜¯æœ‰ç”¨çš„ï¼ŒåŸå› æœ‰ä¸¤ä¸ª:

*   å®ƒæ›´å¿«:æ‚¨ä¸å¿…ç­‰åˆ° API å“åº”åˆ°æ¥ï¼Œä¹Ÿä¸å¿…å¤„ç†é€Ÿç‡é™åˆ¶ã€‚
*   å®ƒè®©ä½ çš„æµ‹è¯•å˜å¾—â€œçº¯ç²¹â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæµ‹è¯•æˆåŠŸä¸å¦åªå–å†³äºä½ çš„ä»£ç ï¼Œè€Œä¸å–å†³äº API è¿”å›çš„æ•°æ®ã€‚
*   ä»é•¿è¿œæ¥çœ‹æ›´å®¹æ˜“:åœ¨å¼€å§‹æµ‹è¯•æŸä¸ªç«¯ç‚¹ä¹‹å‰ï¼Œä¸éœ€è¦é¦–å…ˆç™»å½•æˆ–è®¾ç½®ä¸€äº›çŠ¶æ€ã€‚

# è®¾ç½®ç¬‘è¯

é…ç½® Jest [å¹¶æ²¡æœ‰é‚£ä¹ˆéš¾](https://facebook.github.io/jest/docs/getting-started.html)ï¼Œä½†æ˜¯ä¸ºäº†å¿«é€Ÿä¸Šæ‰‹ï¼Œæˆ‘ä½¿ç”¨äº†è„¸ä¹¦çš„å®˜æ–¹å…¥é—¨å¥—ä»¶ [create-react-app](https://github.com/facebookincubator/create-react-app) ã€‚è¿™æ˜¯ä¸€ä¸ªç°æˆçš„ Jest é…ç½®ï¼

å®‰è£… create-react-app å¹¶åˆ›å»ºåº”ç”¨ç¨‹åº:

```
yarn global add create-react-app

create-react-app mocking-with-jest
cd mocking-with-jest/
yarn start
```

è¿™å°†æ‰“å¼€ä¸€ä¸ªå¸¦æœ‰æ—‹è½¬ React æ ‡å¿—çš„æµè§ˆå™¨çª—å£ã€‚

ç°åœ¨å¯åŠ¨ Jest æµ‹è¯•ç¯å¢ƒ:

```
yarn test
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

![](img/5ac7c241aaac9c141096c3e61bd1776e.png)

æ­å–œï¼Œæ‚¨ç°åœ¨å·²ç»å¯åŠ¨å¹¶è¿è¡Œäº† Jestï¼Œå¹¶å‡†å¤‡å¼€å§‹ç¼–å†™ä¸€äº›æµ‹è¯•äº†ï¼

# æ·»åŠ  API

æˆ‘ä»¬å°†ä½¿ç”¨ [rest.js](https://github.com/cujojs/rest) æ¥å‘å‡º API è¯·æ±‚ã€‚Rest.js åœ¨æµè§ˆå™¨å’Œ Node.js ä¸­è¿è¡Œè‰¯å¥½ã€‚

```
yarn add rest
```

åœ¨æ–‡ä»¶å¤¹ *src* ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ *api* ï¼Œæ·»åŠ æ–‡ä»¶ **github.js** ï¼Œä»£ç å¦‚ä¸‹:

ç„¶åè¿˜ç”¨ä¸‹é¢çš„ä»£ç æ·»åŠ  **request.js** :

ç°åœ¨ï¼Œæ‚¨å·²ç»å‡†å¤‡å¥½ä½¿ç”¨**github . getuser(' vnglst ')**å‘å‡º API è¯·æ±‚äº†ã€‚è®©æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¿«é€Ÿæµ‹è¯•ä¸€ä¸‹ã€‚ç”¨ä»¥ä¸‹ä»£ç æ›¿æ¢æ–‡ä»¶ **App.js** ä¸­çš„åŸå§‹å†…å®¹:

ä½¿ç”¨**çº±çº¿å¯åŠ¨**æ‰“å¼€æµè§ˆå™¨å¹¶æŸ¥çœ‹ç»“æœã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªåŒ…å«æˆ‘çš„ä¸ªäººèµ„æ–™çš„ç®€å•åˆ—è¡¨ã€‚æœ‰ç”¨ï¼

# å†™ä½œæµ‹è¯•

æˆ‘ä»¬ç°åœ¨å‡†å¤‡ç¼–å†™ä¸€äº›æµ‹è¯•ã€‚è®©æˆ‘ä»¬é¦–å…ˆå°è¯•å¯¹å‡½æ•° **getUser** è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ **__tests__** ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ **github.test.js** ï¼Œä»£ç å¦‚ä¸‹:

ä½¿ç”¨**çº±çº¿æµ‹è¯•**å¯åŠ¨ Jestï¼Œæ‚¨ä¼šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯:

![](img/c4ca8630e19d4be7288a7e6230e4c73f.png)

è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿäº‹å®è¯æ˜ï¼Œåœ¨èŠ‚ç‚¹ç¯å¢ƒ(Jest ç”¨æ¥è¿è¡Œæµ‹è¯•çš„èŠ‚ç‚¹ç¯å¢ƒ)ä¸­ä½¿ç”¨æˆ‘ä»¬çš„ **getUser** å‡½æ•°ä¼šä½¿æˆ‘ä»¬çš„è¯·æ±‚å¤±è´¥ã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬çš„åŠŸèƒ½åœ¨æµè§ˆå™¨ä¸­å·¥ä½œï¼Œå®ƒåœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­å¤±è´¥äº†ï¼å½“æˆ‘ä»¬åœ¨èŠ‚ç‚¹ç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ª*ç”¨æˆ·ä»£ç†*å¤´æ¥å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ¨¡ä»¿ç°åœ¨æ˜¯ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼

# åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿ

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ __mocks__ å¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ **request.js** (è¿™å°†æ˜¯çˆ¶æ–‡ä»¶å¤¹ä¸­ request.js çš„æ¨¡æ‹Ÿç‰ˆæœ¬):

è¢«æ¨¡ä»¿çš„å‡½æ•°æœŸæœ›æ–‡ä»¶å¤¹ __mockData__ ä¸­æœ‰ä¸€ä¸ª *userId.json* (å³ *vnglst.json* )æ–‡ä»¶ã€‚æˆ‘åœ¨è¿™é‡Œä½¿ç”¨äº†è‡ªå·±çš„ Github ç”¨æˆ·åå’Œæ•°æ®ä½œä¸ºç¤ºä¾‹ï¼Œä½†æ˜¯æ‚¨å¯ä»¥æ ¹æ®æµ‹è¯•éœ€è¦æ·»åŠ ä»»æ„æ•°é‡çš„ç¤ºä¾‹æ•°æ®:

è¦è®© Jest æ¨¡ä»¿è¯·æ±‚æ¨¡å—ï¼Œæ‚¨å¿…é¡»å°†ä¸‹é¢ä¸€è¡Œæ·»åŠ åˆ° **github.test.js** æ–‡ä»¶ä¸­:

```
jest.mock(â€˜../requestâ€™)
```

ç°åœ¨ç®€å•çš„å•å…ƒæµ‹è¯•åº”è¯¥é€šè¿‡äº†ï¼Œæ‚¨å·²ç»å‡†å¤‡å¥½ç¼–å†™æ›´å¤æ‚çš„æµ‹è¯•äº†ï¼

æˆ‘å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹ï¼Œå¹¶éšæ—¶é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚ä½ å¯ä»¥åœ¨ Twitter ä¸Šæ‰¾åˆ°æˆ‘çš„åå­—æ˜¯ [@vnglst](https://twitter.com/vnglst/) ã€‚æœ¬æ•™ç¨‹çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:[https://github.com/vnglst/mocking-with-jest](https://github.com/vnglst/mocking-with-jest)

æœ¬æ•™ç¨‹åŸºäº Jest çš„åˆ›å»ºè€…çš„å¼‚æ­¥ä¾‹å­(ä»–ä»¬çš„ä¾‹å­å¯èƒ½æ›´å¥½)ğŸ˜‚).ä¸€å®šè¦çœ‹çœ‹ä»–ä»¬çš„å…¶ä»–ä¾‹å­ã€‚

## *å¥–åŠ±:ä½¿ç”¨å¼‚æ­¥/ç­‰å¾…è¿›è¡Œæµ‹è¯•*

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ **create-react-app** ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ async/await æ¥ç¼–å†™ä½ çš„æµ‹è¯•ã€‚è¿™æ— ç–‘ä½¿æ‚¨çš„æµ‹è¯•æ›´å®¹æ˜“ç¼–å†™ï¼Œå¯è¯»æ€§æ›´å¥½:

[![](img/50ef4044ecd4e250b5d50f368b775d38.png)](http://bit.ly/HackernoonFB)[![](img/979d9a46439d5aebbdcdca574e21dc81.png)](https://goo.gl/k7XYbx)[![](img/2930ba6bd2c12218fdbbf7e02c8746ff.png)](https://goo.gl/4ofytp)

> [é»‘å®¢ä¸­åˆ](http://bit.ly/Hackernoon)æ˜¯é»‘å®¢å¦‚ä½•å¼€å§‹ä»–ä»¬çš„ä¸‹åˆã€‚æˆ‘ä»¬æ˜¯é˜¿ç¾æ—å®¶åº­çš„ä¸€å‘˜ã€‚æˆ‘ä»¬ç°åœ¨[æ¥å—æŠ•ç¨¿](http://bit.ly/hackernoonsubmission)å¹¶ä¹æ„[è®¨è®ºå¹¿å‘Š&èµåŠ©](mailto:partners@amipublications.com)æœºä¼šã€‚
> 
> å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•…äº‹ï¼Œæˆ‘ä»¬æ¨èä½ é˜…è¯»æˆ‘ä»¬çš„[æœ€æ–°ç§‘æŠ€æ•…äº‹](http://bit.ly/hackernoonlatestt)å’Œ[è¶‹åŠ¿ç§‘æŠ€æ•…äº‹](https://hackernoon.com/trending)ã€‚ç›´åˆ°ä¸‹ä¸€æ¬¡ï¼Œä¸è¦æŠŠä¸–ç•Œçš„ç°å®æƒ³å½“ç„¶ï¼

![](img/be0ca55ba73a573dce11effb2ee80d56.png)