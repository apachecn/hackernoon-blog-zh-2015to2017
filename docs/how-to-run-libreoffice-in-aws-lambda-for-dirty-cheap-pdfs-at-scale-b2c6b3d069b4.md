# å¦‚ä½•åœ¨ AWS Lambda ä¸­è¿è¡Œ LibreOffice æ¥å¤§è§„æ¨¡å¤„ç†å»‰ä»·çš„ pdf æ–‡ä»¶

> åŸæ–‡ï¼š<https://medium.com/hackernoon/how-to-run-libreoffice-in-aws-lambda-for-dirty-cheap-pdfs-at-scale-b2c6b3d069b4>

![](img/9b45ac77a475978e50d2de62c876a195.png)

## æ‚¨çŸ¥é“å—ï¼Œä½¿ç”¨ LibreOffice å¯ä»¥å°†è¿‘ 100 ç§æ–‡æ¡£æ ¼å¼è½¬æ¢ä¸º PDF æ ¼å¼ï¼Ÿä½ çŸ¥é“ç°åœ¨ä½ å¯ä»¥ç”¨ Lambda æ¥åšè¿™ä¸ªå—ï¼Ÿ**TLï¼›DRï¼›** [åœ¨çº¿è¯•ç©](https://vladholubiev.com/serverless-libreoffice)å’Œ [github æ¥æº](https://github.com/vladgolubev/serverless-libreoffice)

è¿™ç¯‡çŸ­æ–‡å°†å›ç­”ä¸¤ä¸ªç®€å•çš„é—®é¢˜**ä¸ºä»€ä¹ˆï¼Ÿ**å’Œ**å¦‚ä½•ï¼Ÿ** *è·³åˆ°å¦‚ä½•ã€‚*

# ä¸ºä»€ä¹ˆï¼Ÿ

ä¸ºäº†ä¸ç ´åä½ çš„æœŸæœ›ï¼Œè®©æˆ‘ä»¬ä»ä¸€å¼€å§‹å°±æ¾„æ¸…ä¸€äº›äº‹æƒ…ã€‚

> è‡³å°‘ç°åœ¨è¿˜ä¸èƒ½åœ¨ç”Ÿäº§ä¸­è¿è¡Œã€‚

å¥½å§ï¼Œé‚£æˆ‘ä»¬ç»§ç»­ã€‚å¦‚æœä½ æ›¾ç»ä¸å¾—ä¸å°† office æ–‡æ¡£è½¬æ¢æˆ pdfï¼Œä½ å¯èƒ½çŸ¥é“å…¶ä¸­çš„ç—›è‹¦ã€‚è¿™ä¸ªå·¥ä½œæ²¡æœ‰é‚£ä¹ˆå¤šå¼€æºç”šè‡³å•†ä¸šçš„å·¥å…·ã€‚

å—åˆ°æœ€è¿‘ä¸€ä¸ªåœ¨ Lambda ä¸­è¿è¡Œè°·æ­Œ Chrome çš„æ•…äº‹çš„å¯å‘ï¼Œæˆ‘å¾ˆæƒ³ä¸ºæˆ‘è¿«åˆ‡éœ€è¦çš„ä¸œè¥¿é‡å¤ä¸€æ¬¡ç±»ä¼¼çš„å£®ä¸¾ã€‚å›¾ä¹¦é¦†å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚æˆ‘åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œäº†ä¸€å¹´ï¼Œå®ƒéœ€è¦éå¸¸å°å¿ƒã€‚å½“ä½ åœ¨ä¸€ä¸ªå®¹å™¨ä¸Šè¿è¡Œå¤šä¸ªå®ä¾‹æ—¶ï¼ŒLibreOffice ä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚è¿›ç¨‹ç»å¸¸ä¼šå˜æˆåƒµå°¸ï¼Œåƒæ‰æ‰€æœ‰çš„å†…å­˜ã€‚æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥é€šè¿‡å¥—æ¥å­—å°†å®ƒä½œä¸ºâ€œæœåŠ¡å™¨â€è¿è¡Œï¼Œä½†è¿™ç§æ–¹æ³•æ›´åŠ ä¸ç¨³å®šã€‚

æˆ‘å¯¹æ­¤å’†å“®äº†ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ° Accusoft çš„ä¸€åé”€å”®äººå‘˜æ‰¾åˆ°æˆ‘ï¼Œè¯•å›¾å‘æˆ‘æ¨é”€ä»–ä»¬çš„æ–‡æ¡£è½¬æ¢è§£å†³æ–¹æ¡ˆã€‚

å”¯ä¸€çš„é—®é¢˜æ˜¯ä»·æ ¼å¯¹æˆ‘æ¥è¯´å¤ªé«˜äº†:æ¯å°æœåŠ¡å™¨ 7400 ç¾å…ƒæˆ–è€…æ¯ç™¾ä¸‡ä»½æ–‡æ¡£ 10000 ç¾å…ƒã€‚

è¿™å¤ªè’è°¬äº†ï¼Œæˆ‘å†³å®šè‡ªå·±å»ºé€ å®ƒã€‚ä»¥ä¸‹æ˜¯æ–¹æ³•ã€‚

# æ€ä¹ˆä¼šï¼Ÿ

å› æ­¤ï¼Œç»è¿‡å¿«é€Ÿè®¡ç®—ï¼Œæˆ‘å¾—å‡ºçš„ä»·æ ¼æ˜¯æ¯ç™¾ä¸‡ä»½æ–‡æ¡£ 150 ç¾å…ƒã€‚æ¯”ä¸€ä¸‡ç¾å…ƒå¥½å¤ªå¤šäº†ï¼Œä¸æ˜¯å—ï¼Ÿåæ¥è¯æ˜æ˜¯æ­£ç¡®çš„ã€‚

å¦‚ä½ æ‰€è§ï¼Œä»·æ ¼çš„ä¸»è¦é©±åŠ¨åŠ›æ˜¯ S3ï¼Œè€Œä¸æ˜¯ Lambdaï¼Œè¿™å¯¹æˆ‘æ¥è¯´å¾ˆæœ‰è¶£ã€‚

![](img/f22aa2f8d764ae2724131effbd710efe.png)

Approximate price estimations: $150 for 1 million files. Worth trying!

å› æ­¤ï¼Œæœ‰ä¸¤ä¸ªé—®é¢˜é˜»ç¢äº†å°† LibreOffice å¼•å…¥ Lambda:

1.  å°ºå¯¸ã€‚å®‰è£…åœ¨ç³»ç»Ÿä¸Šå®ƒéœ€è¦åƒå…†å­—èŠ‚çš„ç£ç›˜ç©ºé—´
2.  ä¾¿æºæ€§ã€‚å®ƒä¾èµ–äºè®¸å¤š Lambda ä¸­æ²¡æœ‰çš„å¤–æ¥åº“ã€‚

## å¤§å°

è€ƒè™‘åˆ° Lambda ä¸­ 512MB çš„ç£ç›˜ç©ºé—´ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„æŒ‘æˆ˜ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ‚¨å¯ä»¥åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç¦ç”¨å¤§é‡åƒåœ¾ã€‚ä¸Šå¸ï¼Œä¸ºä»€ä¹ˆæˆ‘éœ€è¦ JDBC å¸æœºæˆ– KDE æ‰©å±•ã€‚è¿™å°±æ˜¯ LibreOffice å¤§å°å¦‚ä½•ä» 2gb å‡å°‘åˆ° 0.45 GB çš„åŸå› ã€‚

450 MB å·²ç»è¶³å¤Ÿè£…ä¸‹ Lambda äº†ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¤šã€‚`strip **/*` æ˜¯ä»å…±äº«å¯¹è±¡ä¸­ç§»é™¤ç¬¦å·çš„ç¥å¥‡å‘½ä»¤(ã€‚so æ–‡ä»¶)

æ‰€ä»¥ç°åœ¨çš„å¤§å°æ˜¯ 340 MBï¼Œä¹Ÿå°±æ˜¯ 110 MB çš„ gzipğŸ‰

## è½»ä¾¿

ä¸ºäº†ä¸º Lambda ç¼–è¯‘ä»»ä½•ä¸œè¥¿ï¼Œä½ éœ€è¦åœ¨ç›¸åŒçš„ç¯å¢ƒä¸‹è¿™æ ·åšã€‚ç›®å‰è¿™æ˜¯ 2017.03 äºšé©¬é€Š Linux AMIã€‚å¦‚æœå®ƒè¿è¡Œåœ¨é‚£é‡Œï¼Œé‚£ä¹ˆå®ƒè¿è¡Œåœ¨Î»ä¸­ã€‚

ä¸ºäº†ç¼–è¯‘ï¼Œä½ éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„æœåŠ¡å™¨ã€‚æˆ‘æ‹¿çš„æ˜¯ 16 æ ¸ C5 çš„é‚£ä¸ªã€‚

æˆ‘ä¸ä¼šæ·±ç©¶ç¼–è¯‘è¿‡ç¨‹çš„ç»†èŠ‚ï¼Œä½†æ˜¯å¤©å“ªï¼Œé‚£å¤ªéš¾äº†ã€‚æˆ‘å¯¹ node.js ä¹‹å¤–çš„ä»»ä½•ä¸œè¥¿éƒ½ä¸€æ— æ‰€çŸ¥ï¼Œæƒ³è±¡ä¸€ä¸‹å½“æˆ‘è¯•å›¾ç¼–è¯‘è¿™ä¸ªæ€ªç‰©æ—¶ï¼Œæˆ‘è¯»åˆ°äº†ç¥ç§˜çš„ C++é”™è¯¯ã€‚

![](img/302404430355537b1ab04d35c05406f9.png)

The codebase is 32 years old ğŸ˜°

æˆ‘åœ¨ GitHub repo ä¸­æ”¶é›†äº†é¡ºåˆ©ç¼–è¯‘æ‰€éœ€çš„æ‰€æœ‰è„šæœ¬ï¼Œæ‰€ä»¥æ‚¨ä¸å¿…äº²è‡ªç»å†è¿™äº›ã€‚

[https://github.com/vladgolubev/serverless-libreoffice](https://github.com/vladgolubev/serverless-libreoffice)

# æ‘˜è¦

æœ‰äº†ä¸€ä¸ªç¼–è¯‘å¥½çš„ LibreOffice æ–‡ä»¶å¤¹ï¼Œä½ å¯ä»¥ç”¨ Lambda å‡½æ•°å‹ç¼©å®ƒï¼Œç„¶åè¿›è¡Œéƒ¨ç½²ã€‚åœ¨å¯åŠ¨æ—¶ï¼Œå°†å®ƒè§£å‹åˆ°`/tmp`æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªè¿›ç¨‹ã€‚

é™„:æŸ¥çœ‹[æ›´è¯¦ç»†çš„åˆ†æ­¥æŒ‡å—](https://github.com/vladgolubev/serverless-libreoffice/blob/master/STEP_BY_STEP.md)ã€‚è¿˜æœ‰ä¸€ä¸ª [NPM å›¾ä¹¦é¦†](https://github.com/shelfio/aws-lambda-libreoffice)ã€‚

æ­¤å¤–ï¼Œæˆ‘æ”¾äº†ä¸€ä¸ªæ¼”ç¤ºï¼Œæ‰€ä»¥ä½ å¯ä»¥å°½å¿«å°è¯•ã€‚æ—‹è½¬ä¸€ä¸‹ï¼

> [https://vladholubiev.com/serverless-libreoffice](https://vladholubiev.com/serverless-libreoffice)

å¦‚æœä½ å¯¹è¿™ç±»å†…å®¹æ„Ÿå…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰å…³äºåœ¨ AWS Lambda ä¸­è¿è¡Œ Docker å®¹å™¨çš„æ–‡ç« ã€‚