# åœ¨ç°å®ç”Ÿæ´»ä¸­ä½¿ç”¨å¯è§‚å¯Ÿçš„äº‹ç‰©

> åŸæ–‡ï¼š<https://medium.com/hackernoon/using-observables-to-make-our-app-work-with-barcode-scanners-e8a673fba625>

![](img/583d4bbcdb16d630df2690c870b44ce7.png)

*è¿™ä¸ªæ•…äº‹ä¹Ÿè¢«è´´åœ¨äº†æˆ‘çš„ä¸ªäººåšå®¢* *ä¸Šçš„* [*ã€‚*](https://www.nicoespeon.com/en/2017/03/using-observables-in-real-life/)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºä¸€ä¸ªå…·ä½“çš„ç”¨ä¾‹ï¼Œåœ¨è¿™ä¸ªç”¨ä¾‹ä¸­ï¼Œå¯è§‚å¯Ÿæ€§å˜å¾—éå¸¸é‡è¦ï¼Œä½¿æˆ‘ä»¬çš„ä»£ç æ›´åŠ æ•´æ´ï¼Œæ›´æ˜“äºç»´æŠ¤ã€‚

## å¦‚ä½•è¯†åˆ«æ¡å½¢ç æ‰«æä»ªï¼Ÿï¼

æ²¡é”™ã€‚è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä¾‹å­ã€‚ä½†å®ƒå®Œç¾åœ°è¯´æ˜äº†ä¸€äº›é—®é¢˜ï¼Œè¿™äº›é—®é¢˜ä¼šè®©ä½ ä¹æ±‚ä½¿ç”¨ Observablesã€‚

ä¸€ä¸ª[æ¡å½¢ç ](https://hackernoon.com/tagged/barcode)æ‰«æä»ªç®€å•åœ°æ¨¡ä»¿é”®ç›˜ã€‚å®ƒå¤åˆ¶æ‰«æçš„ä»£ç ï¼Œå‘å‡ºæŒ‰é”®ä¿¡å·ï¼Œä»¥â€œè¾“å…¥â€é”®ç»“æŸâ€”â€”è¯¥é”®ç æ˜¯ *13* ã€‚

å‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå…è®¸ç”¨æˆ·ä»ä»–ä»¬çš„ 16 ä¸ªå­—ç¬¦çš„ä»£ç å‚è€ƒä¸­æœç´¢äº§å“ã€‚ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä½¿ç”¨æ¡å½¢ç æ‰«æä»ªæ¥è§¦å‘æœç´¢ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨è¾“å…¥ã€‚

> "åªè¦è®©ç”¨æˆ·é›†ä¸­æœç´¢è¾“å…¥ï¼Œæ‰«æå°±å¤§åŠŸå‘Šæˆäº†ï¼"

å½“ç„¶ï¼Œè¿™æ˜¯å¤©ç”Ÿçš„è¡Œä¸ºã€‚

ä½†æ˜¯æœç´¢åŠŸèƒ½åŒ…å«åœ¨ä¸€ä¸ªå¼¹å‡ºçª—å£ä¸­ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæŒ‰é’®æ‰“å¼€ã€‚æˆ‘ä»¬è¢«å‘ŠçŸ¥è¯¥åº”ç”¨ç¨‹åºåº”è¯¥æ˜¯è¶…çº§ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„ï¼æ¯å½“ç”¨æˆ·æ‰«ææ¡å½¢ç æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æ‰“å¼€å¼¹å‡ºçª—å£ï¼Œå¹¶ç”¨æ‰«æçš„ä»£ç å¡«å……è¾“å…¥ã€‚

ç°åœ¨ï¼Œé—®é¢˜æ˜¯:æˆ‘ä»¬å¦‚ä½•å°†æ‰«æçš„ä»£ç ä¸å…¶ä»–æŒ‰é”®äº‹ä»¶åŒºåˆ†å¼€æ¥ï¼Ÿå‡è®¾ç”¨æˆ·åœ¨æ‰«æä»£ç ä¹‹å‰æŒ‰äº†ä¸€ä¸ªé”®:æˆ‘ä»¬ä¸å¸Œæœ›è¿™ä¸ªé”®æ˜¯è¢«æ‰«æä»£ç çš„ä¸€éƒ¨åˆ†ï¼

## è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå½“åŠ¡ä¹‹æ€¥æ˜¯

æˆ‘ä»¬å½“ç„¶éœ€è¦ç›‘å¬æŒ‰é”®äº‹ä»¶â€¦ç„¶åæˆ‘ä»¬å¿…é¡»â€¦è®°ä½æŒ‰é”®ä»£ç ï¼Œå¯èƒ½è¦ä½¿ç”¨ç¼“å†²åŒºï¼å¦‚æœæŒ‰ä¸‹çš„é”®æ˜¯â€œè¾“å…¥â€é”®ï¼Œåˆ™å¡«å……è¾“å…¥å¹¶æ¸…ç†ç¼“å†²åŒºã€‚å¦åˆ™ï¼Œå°†å¯†é’¥æ·»åŠ åˆ°ç¼“å†²åŒºä¸­ï¼

è®©æˆ‘ä»¬è¯•è¯•ç¬¬ä¸€ä¸ªé•œå¤´:

å¾ˆå¥½ã€‚

ä½†è¿™è¿˜ä¸å¤Ÿ:å®ƒä¸èƒ½åŒºåˆ†æ‰«æä»£ç å’Œå¸¸è§„æŒ‰é”®ï¼

æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå¤§çº¦ 50 æ¯«ç§’åæ²¡æœ‰å‘å‡ºæ–°çš„æŒ‰é”®ï¼Œè¿™è‚¯å®šä¸æ˜¯æ‰«æä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…ç†ç¼“å†²åŒºã€‚

å—¯â€¦â€¦è¿˜ä¸é”™ã€‚ä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªå¾®å¦™çš„é”™è¯¯:å¦‚æœä»£ç æ‰«ææ—¶é—´è¶…è¿‡ 50 æ¯«ç§’ï¼Œå®ƒå°†ä¸¢å¤±å¼€å¤´â€¦

äº‹å®ä¸Šï¼Œå¦‚æœæ–°çš„æŒ‰é”®åœ¨ 50 æ¯«ç§’å†…å‘ç”Ÿï¼Œæˆ‘ä»¬åº”è¯¥æ¸…é™¤è¶…æ—¶ã€‚

ç°åœ¨æˆ‘ä»¬æœ‰å·¥ä½œäº†ã€‚

è®©æˆ‘ä»¬é€€ä¸€æ­¥æƒ³ä¸€æƒ³:å¦‚æœæˆ‘ä»¬æœ‰æŒ‰é”®äº‹ä»¶çš„å®Œæ•´å†å²ï¼Œæˆ‘ä»¬å¯ä»¥æ“çºµè¿‡æ»¤æ‰«æä»£ç åºåˆ—ï¼Ÿä»£ç ä¼šæ›´ç®€å•å—ï¼Ÿè®©æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€¦

## è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨å¯è§‚çš„

å¯¹äºè¿™ç§ç”¨ä¾‹ï¼Œæˆ‘å‘ç° Observables æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æŠ½è±¡æ¥è¡¨ç¤ºæˆ‘ä»¬çš„æ•°æ®ã€‚

> å¯è§‚å¯Ÿå¯¹è±¡æ˜¯**ä¸å¯å˜çš„å¼‚æ­¥äº‹ä»¶é›†åˆ**ï¼Œæ‚¨å¯ä»¥é€šè¿‡**æ“ä½œç¬¦**å¯¹å…¶è¿›è¡Œæ“ä½œã€‚

å¦‚æœæˆ‘ä»¬åœ¨æ•°ç»„ä¸Šä½¿ç”¨ç±»ä¼¼äº*æ˜ å°„*å’Œ*è¿‡æ»¤*çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆæˆ‘ä»¬å·²ç»ç†Ÿæ‚‰äº†è¿™ç§æ€ç»´æ–¹å¼ã€‚

> å¦‚æœåˆ°ç›®å‰ä¸ºæ­¢å¯è§‚æµ‹é‡å¯¹ä½ æ¥è¯´ä»ç„¶æ˜¯ç¥ç§˜çš„ï¼Œæˆ‘å»ºè®®ä½ å»è¯»è¯»[è¿™ç¯‡æ¥è‡ªå®‰å¾·çƒˆÂ·æ–¯å¡”å°”èŒ¨çš„å…³äºååº”å¼ç¼–ç¨‹çš„ç²¾å½©ä»‹ç»](https://gist.github.com/staltz/868e7e9bc2a7b8c1f754)ã€‚

å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†æ‰€æœ‰äº‹ä»¶æ”¶é›†åˆ°ä¸€ä¸ªå¯ä»¥è½¬æ¢çš„æµä¸­ï¼Œè€Œä¸æ˜¯å•ç‹¬åœ°å“åº”æ¯ä¸ªäº‹ä»¶ã€‚

> å˜é‡åæœ«å°¾çš„ ***$*** ç¬¦å·è¡¨ç¤ºâ€œæµâ€ã€‚
> è¿™æ˜¯ä¸€ä¸ªçº¦å®šï¼Œæˆ‘ç”¨å®ƒæ¥çŸ¥é“æˆ‘æ“ä½œçš„å˜é‡åœ¨éç±»å‹åŒ–è¯­è¨€ä¸­æ˜¯å¯è§‚å¯Ÿçš„ï¼Œå°±åƒæˆ‘ä¼šæŠŠ ***å…ƒç´ *** ç§°ä¸ºä¸€ä¸ªç”± ***å…ƒç´ *** ç»„æˆçš„æ•°ç»„ï¼Œæˆ–è€…æŠŠ ***$header*** ç§°ä¸ºå¤´éƒ¨çš„ jQuery è¡¨ç¤ºã€‚

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸²å…³é”®ä»£ç ã€‚æ¯å½“å‘ç”ŸæŒ‰é”®äº‹ä»¶æ—¶ï¼Œéƒ½ä¼šå‘å‡ºä¸€ä¸ªæ–°äº‹ä»¶ï¼Œè¯¥äº‹ä»¶çš„å€¼æ˜¯ç›¸åº”çš„æŒ‰é”®ä»£ç ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹çš„æœ€åï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå¯ä»¥è®¢é˜…çš„æµã€‚æµä¸­çš„æ¯ä¸ªäº‹ä»¶åº”è¯¥ä»£è¡¨è¢«æ‰«æçš„ä»£ç ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¹é‡ç”Ÿäº§æŒ‰é”®ä»£ç ï¼Œå°†æ‰«æä»£ç ä¸å¯„ç”ŸæŒ‰é”®éš”ç¦»å¼€æ¥ã€‚

ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**å»æŠ–**ç­–ç•¥**ç¼“å†²**æˆ‘ä»¬çš„æµ:å½“ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿæ—¶ï¼Œç­‰å¾… 50 æ¯«ç§’ç­‰å¾…ä¸‹ä¸€ä¸ªäº‹ä»¶ã€‚å¦‚æœåœ¨æ­¤æ—¶é—´èŒƒå›´å†…å‘å‡ºå¦ä¸€ä¸ªäº‹ä»¶ï¼Œå†ç­‰å¾… 50 æ¯«ç§’ã€‚å¦‚æœåœ¨æ­¤æ—¶é—´èŒƒå›´å†…æ²¡æœ‰å‘ç”Ÿå…¶ä»–äº‹ä»¶ï¼Œåˆ™åˆ›å»ºä¸€æ‰¹ä¼ é€’çš„äº‹ä»¶ã€‚

![](img/27dfb801b3f8c1604d238426e6ac76ee.png)

This is what we want to achieve with [the buffer operator](http://reactivex.io/documentation/operators/buffer.html)

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡é¡ºåˆ©ï¼

ç°åœ¨ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯è¿‡æ»¤æ‰é‚£äº›çœ‹èµ·æ¥ä¸åƒæ‰«æç çš„æ‰¹æ¬¡ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ‰«æçš„ä»£ç æ˜¯ä¸€ä¸ªä»¥â€œå›è½¦â€é”®ç»“æŸçš„åºåˆ—ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬è®¢é˜…æˆ‘ä»¬åˆ›å»ºçš„è¿™ä¸ªæµï¼Œå¹¶åœ¨æ¯æ¬¡å‘å‡ºæ–°äº‹ä»¶æ—¶æ‰§è¡Œå›è°ƒã€‚

> é™¤éæˆ‘ä»¬è®¤åŒå¯è§‚å¯Ÿçš„äº‹ç‰©ï¼Œå¦åˆ™ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºå®ƒä»¬æ˜¯æ‡’æƒ°çš„ã€‚

## æˆ‘ä»¬åœ¨è¿™é‡Œåšäº†ä»€ä¹ˆ

è¿™æ˜¯æˆ‘ä»¬ä» *keyCode$* åˆ° *keyCodesBuffer$* çš„å¯è§†åŒ–æ¼”ç¤ºï¼ŒkeyCode$ æ˜¯é€šè¿‡æŒ‰é”®äº‹ä»¶åˆ›å»ºçš„ï¼Œæˆ‘ä»¬è®¢é˜…äº†:

![](img/c11c7bb15c46b8fe6d2abd791f9ae008.png)

Transforming the stream of key codes into a stream of scanned codes

å¯¹äºæˆ‘ä»¬çš„æœ€ç»ˆä»£ç ï¼Œæœ‰ä¸€äº›äº‹æƒ…éœ€è¦æ³¨æ„:

*   æˆ‘ä»¬ä¸å¿…æ‰‹åŠ¨ç®¡ç†è¯¸å¦‚è¶…æ—¶å’Œç¼“å†²ä¹‹ç±»çš„äº‹æƒ…
*   å› æ­¤ï¼Œä»£ç æ›´çŸ­ï¼Œ**å…³æ³¨äºå®é™…å·¥ä½œ**
*   *fillInputWith()* ä¸ä¾èµ–äºå…¨å±€ç¼“å†²åŒºï¼Œè¿™æ›´åŠ **å¯æµ‹è¯•**å’Œ**å¯é‡ç”¨**â€”â€”å®é™…ä¸Šï¼Œæˆ‘ä»¬ç¦»ä½¿æ•´ä¸ªé€»è¾‘å®Œå…¨åŠŸèƒ½åŒ–åªæœ‰å‡ æ­¥ä¹‹é¥
*   æˆ‘ä»¬åªæ˜¯æ“çºµ*å¸¸é‡* sï¼Œæ²¡æœ‰ä»»ä½•ä¸œè¥¿è¢«é‡æ–°åˆ†é…ï¼Œè¿™ä½¿å¾—**æ¨ç†**æ›´åŠ ç®€å•
*   åˆ›å»ºçš„æµå¯ä»¥è¢«**é‡ç”¨**æ¥åšå…¶ä»–äº‹æƒ…ï¼›æˆ‘ä»¬å¯ä»¥**æ·»åŠ åŠŸèƒ½ï¼Œè€Œä¸ç”¨æ‹…å¿ƒ**ç ´åè¿™ä¸ªåŠŸèƒ½
*   æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¿®å¤è¿™ä¸ªä»£ç ä¸­çš„é—®é¢˜ï¼Œå¦‚æœå¿…è¦çš„è¯ï¼Œåœ¨æµåˆ›å»ºç®¡é“ä¸­æ³¨å…¥æ“ä½œç¬¦â€”â€”ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä» *keyCode$* ä¸­è¿‡æ»¤æ‰ä¸æ„Ÿå…´è¶£çš„é”®ç ï¼Œå°±åƒ*ä¸€æ ·ç®€å•ã€‚è¿‡æ»¤å™¨(isValidKeyCode)*

åœ¨æˆ‘çœ‹æ¥ï¼Œä¸€ä¸ªå›°éš¾çš„äº‹æƒ…æ˜¯ç”¨æµæ¥æ¨ç†ï¼Œå¹¶ç†è§£å¦‚ä½•ç”¨ç»™å®šçš„æ“ä½œç¬¦æ¥è§£å†³æˆ‘ä»¬çš„ç”¨ä¾‹ã€‚

ä½†æ˜¯ï¼Œæˆ‘ç›¸ä¿¡è¿™åªæ˜¯éœ€è¦ç»ƒä¹ ğŸ˜‰

[![](img/50ef4044ecd4e250b5d50f368b775d38.png)](http://bit.ly/HackernoonFB)[![](img/979d9a46439d5aebbdcdca574e21dc81.png)](https://goo.gl/k7XYbx)[![](img/2930ba6bd2c12218fdbbf7e02c8746ff.png)](https://goo.gl/4ofytp)

> [é»‘å®¢ä¸­åˆ](http://bit.ly/Hackernoon)æ˜¯é»‘å®¢å¦‚ä½•å¼€å§‹ä»–ä»¬çš„ä¸‹åˆã€‚æˆ‘ä»¬æ˜¯ [@AMI](http://bit.ly/atAMIatAMI) å®¶åº­çš„ä¸€å‘˜ã€‚æˆ‘ä»¬ç°åœ¨[æ¥å—æŠ•ç¨¿](http://bit.ly/hackernoonsubmission)å¹¶ä¹æ„[è®¨è®ºå¹¿å‘Š&èµåŠ©](mailto:partners@amipublications.com)æœºä¼šã€‚
> 
> å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•…äº‹ï¼Œæˆ‘ä»¬æ¨èä½ é˜…è¯»æˆ‘ä»¬çš„[æœ€æ–°ç§‘æŠ€æ•…äº‹](http://bit.ly/hackernoonlatestt)å’Œ[è¶‹åŠ¿ç§‘æŠ€æ•…äº‹](https://hackernoon.com/trending)ã€‚ç›´åˆ°ä¸‹ä¸€æ¬¡ï¼Œä¸è¦æŠŠä¸–ç•Œçš„ç°å®æƒ³å½“ç„¶ï¼

![](img/be0ca55ba73a573dce11effb2ee80d56.png)