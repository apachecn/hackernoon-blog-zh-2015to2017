<html>
<head>
<title>Handling errors in gRPC and go-kit services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¤„ç†gRPCå’Œgo-kitæœåŠ¡ä¸­çš„é”™è¯¯</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/handling-errors-in-golang-grpc-and-go-kit-services-d0fa0a112449?source=collection_archive---------6-----------------------#2017-11-02">https://medium.com/hackernoon/handling-errors-in-golang-grpc-and-go-kit-services-d0fa0a112449?source=collection_archive---------6-----------------------#2017-11-02</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/87b0973e9af1ccdb50f32adb6469f3d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ccuxKW-yUILVqqvpmBb-A.png"/></div></div></figure><div class=""/><p id="a95b" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å¦‚æœæ‚¨æŸ¥æ‰¾å¦‚ä½•å¤„ç†gRPC/go-kitæœåŠ¡ä¸­çš„è‡ªå®šä¹‰é”™è¯¯ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°ä¸€äº›ç²—ç•¥çš„è¯´æ˜ï¼Œä½†æ²¡æœ‰ç³»ç»Ÿã€‚è¿™æ˜¯ä¸€ä¸ªä»¤äººæ²®ä¸§çš„é—æ¼ï¼Œå› ä¸ºè‡ªå®šä¹‰é”™è¯¯åœ¨Goé¡¹ç›®ä¸­æ˜¯æœ‰ç”¨ä¸”å¸¸è§çš„ã€‚è¿™æ˜¯æˆ‘çš„å°è¯•ã€‚</p><ol class=""><li id="27dd" class="ka kb if je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki dt translated">åœ¨protobufä¸­å®šä¹‰ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼ŒåŒ…å«æœåŠ¡å†…éƒ¨å’ŒæœåŠ¡ä¹‹é—´æ‰€éœ€çš„å­—æ®µ/æ•°æ®ã€‚</li><li id="31a9" class="ka kb if je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">ä¸ºç”Ÿæˆçš„é”™è¯¯å®ç°Goçš„é”™è¯¯æ¥å£ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥åƒGoä¸­çš„å…¶ä»–é”™è¯¯ä¸€æ ·è¢«ä¼ é€’ã€‚</li><li id="34e4" class="ka kb if je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">æ”¯æŒå †æ ˆè·Ÿè¸ªï¼Œä»¥ä¾¿æ‚¨å¯ä»¥çœ‹åˆ°é”™è¯¯çš„æ¥æºå¹¶äº†è§£å®ƒæ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚</li><li id="039e" class="ka kb if je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki dt translated">åœ¨å“åº”çš„å­—æ®µä¸­å“åº”é”™è¯¯ï¼Œä»è€Œå‘å…¶ä»–æœåŠ¡å…¬å¼€é”™è¯¯ã€‚</li></ol><h1 id="4b6f" class="ko kp if bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">åœ¨protobufä¸­å®šä¹‰ä¸€ä¸ªæœ‰ç”¨çš„é”™è¯¯æ¶ˆæ¯</h1><p id="2d42" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">ä»€ä¹ˆæ˜¯æœ‰ç”¨çš„é”™è¯¯ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬çš„é”™è¯¯éœ€è¦ä¸€æ¡ç±»ä¼¼â€œæ‰¾ä¸åˆ°ç”¨æˆ·â€çš„æ¶ˆæ¯å’Œä¸€ä¸ªç±»ä¼¼404çš„ä»£ç ã€‚æ­¤å¤–ï¼ŒåµŒå¥—é”™è¯¯é€‚ç”¨äºéªŒè¯ä¹‹ç±»çš„æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé”™è¯¯ç”±ä¸‹å±ç»„æˆï¼Œæ¶ˆæ¯å¯èƒ½ç±»ä¼¼äºå¸¦æœ‰åµŒå¥—é”™è¯¯çš„â€œæ— æ•ˆç”¨æˆ·â€{â€œemailâ€:â€œå¿…é¡»è®¾ç½®â€ï¼Œâ€œ<a class="ae lr" href="https://hackernoon.com/tagged/password" rel="noopener ugc nofollow" target="_blank">å¯†ç </a>â€:â€œå¿…é¡»æ›´å¼ºâ€}ã€‚ä¸€æ®µå­—ç¬¦ä¸²ç”¨äºæ•æ‰æ‰€æœ‰å…¶ä»–ç»†èŠ‚â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦ä¸€ä¸ªæœ¬åœ°åŒ–çš„ã€é¢å‘ç”¨æˆ·çš„æ¶ˆæ¯ï¼›æŠŠå®ƒæ”¾åœ¨ç»†èŠ‚é‡Œã€‚</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="13ea" class="mb kp if lx b fv mc md l me mf">// example.proto<br/><br/>message Error {<br/>  string message = 1;<br/>  int32 code = 2;<br/>  map&lt;string, string&gt; nested_errors = 3;<br/>  repeated string details = 4;<br/>  bytes stack = 5 [(gogoproto.customtype) = "Stack"];<br/>}</span></pre><h1 id="6058" class="ko kp if bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">å®ç°é”™è¯¯æ¥å£</h1><p id="2b95" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">é€šè¿‡å®ç°erroræ¥å£ï¼Œæ‚¨å¯ä»¥åƒå¤„ç†writing Goä¸­çš„ä»»ä½•å…¶ä»–é”™è¯¯ä¸€æ ·ä¼ é€’å’Œä½¿ç”¨é”™è¯¯ã€‚æ‚¨å°†å¸Œæœ›æ‚¨çš„å‡½æ•°ä¹Ÿå°†æ‚¨çš„è‡ªå®šä¹‰é”™è¯¯ä½œä¸ºé”™è¯¯æ¥å£è¿”å›ï¼Œå¦åˆ™æ‚¨å°†é‡åˆ°è¿™ç§ä»¤äººå›°æƒ‘çš„è¡Œä¸º:<a class="ae lr" href="https://golang.org/doc/faq#nil_error" rel="noopener ugc nofollow" target="_blank">ä¸ºä»€ä¹ˆæˆ‘çš„nilé”™è¯¯å€¼ä¸ç­‰äºnilï¼Ÿ</a></p><blockquote class="mg mh mi"><p id="1821" class="jc jd mj je b jf jg jh ji jj jk jl jm mk jo jp jq ml js jt ju mm jw jx jy jz hn dt translated">å¯¹äºè¿”å›é”™è¯¯çš„å‡½æ•°æ¥è¯´ï¼Œæœ€å¥½æ€»æ˜¯åœ¨å®ƒä»¬çš„ç­¾åä¸­ä½¿ç”¨<code class="eh mn mo mp lx b">error</code>ç±»å‹(å°±åƒæˆ‘ä»¬ä¸Šé¢åšçš„é‚£æ ·),è€Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œæ¯”å¦‚<code class="eh mn mo mp lx b">*MyError</code>,ä»¥å¸®åŠ©ä¿è¯é”™è¯¯è¢«æ­£ç¡®åœ°åˆ›å»ºã€‚ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œ<code class="eh mn mo mp lx b"><a class="ae lr" href="https://golang.org/pkg/os/#Open" rel="noopener ugc nofollow" target="_blank">os.Open</a></code>è¿”å›ä¸€ä¸ª<code class="eh mn mo mp lx b">error</code>ï¼Œå³ä½¿å¦‚æœä¸æ˜¯<code class="eh mn mo mp lx b">nil</code>ï¼Œå®ƒæ€»æ˜¯å…·ä½“ç±»å‹<code class="eh mn mo mp lx b"><a class="ae lr" href="https://golang.org/pkg/os/#PathError" rel="noopener ugc nofollow" target="_blank">*os.PathError</a></code>ã€‚</p></blockquote><p id="d9e7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘åœ¨ç½‘ä¸Šçœ‹è¿‡ä¸€äº›æ„è§ï¼Œå¤§éƒ¨åˆ†æ¥è‡ªè°·æ­Œé˜µè¥ï¼Œä»–ä»¬è®¤ä¸ºç¼–è¯‘åçš„protobufä»£ç åº”è¯¥ä¸ä½ è‡ªå·±æ‰‹å†™çš„ä»£ç åˆ†å¼€ä¿å­˜ï¼Œè¿™æ ·è¿™ä¸ªAPIå°±ä¸å¯èƒ½åœ¨Goä¸­ä½¿ç”¨ã€‚ç›¸åï¼Œæ‚¨åº”è¯¥åœ¨protobufä¸­å®šä¹‰ä¸€ä¸ªé”™è¯¯ï¼Œåœ¨æ‚¨çš„ä»£ç ä¸­å®šä¹‰ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶æ ¹æ®éœ€è¦å°†å®ƒä»¬ç›¸äº’è½¬æ¢ã€‚ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œæ‰‹å†™ä»£ç å’Œprotobufsä¸€èµ·å¹¶æ²¡æœ‰é€ æˆé—®é¢˜ï¼Œå¹¶ä¸”æœ‰åˆ©äºåƒè¿™æ ·çš„APIå’Œå…¶ä»–æœ‰ç”¨çš„APIï¼Œæ¯”å¦‚ç”¨äºé€šå¸¸æ£€ç´¢çš„åµŒå¥—å­—æ®µçš„gettersã€‚æ‰€ä»¥æˆ‘è¯´ç»§ç»­å§ã€‚</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="23c2" class="mb kp if lx b fv mc md l me mf">// error.go<br/><br/>// assert Error implements the error interface.<br/>var _ error = &amp;Error{}<br/><br/>// Error implements the error interface.<br/>func (e *Error) Error() string {<br/>	b := new(bytes.Buffer)<br/>	e.printStack(b)<br/>	pad(b, ": ")<br/>	b.WriteString(e.Message)<br/>	if b.Len() == 0 {<br/>		return "no error"<br/>	}<br/>	return b.String()<br/>}</span></pre><h1 id="b9b7" class="ko kp if bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">æ”¯æŒå †æ ˆè·Ÿè¸ª</h1><p id="118e" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">å †æ ˆè·Ÿè¸ªå¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰¾åˆ°é”™è¯¯çš„æ¥æºï¼Œå¹¶äº†è§£å®ƒä»¬æ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€‚</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="fa71" class="mb kp if lx b fv mc md l me mf">/path/main.go:20: github.com/travisjeffery/example.c:<br/>	/path/main.go:16: ...b:<br/>	/path/main.go:12: ...a: shit's on fire, yo</span></pre><p id="4af2" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘ä½¿ç”¨gogoçš„protobufåˆ†æ”¯æ¥æ·»åŠ è‡ªå®šä¹‰ç±»å‹çš„å †æ ˆå­—æ®µï¼Œå®˜æ–¹çš„<a class="ae lr" href="https://hackernoon.com/tagged/golang" rel="noopener ugc nofollow" target="_blank"> Golang </a> protobufä¸æ”¯æŒè¿™ç§ç±»å‹ã€‚å…¬å…±å­—æ®µå¾ˆçƒ¦äººï¼Œæˆ‘ä¸å¸Œæœ›å®ƒçš„å†…å®¹è¢«å°é€/è§£å°â€”â€”å‰è€…æˆ‘æ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºprotobufå¯¹ç§æœ‰å­—æ®µå¾ˆæ¼ç«ï¼Œåè€…æˆ‘å¯ä»¥é€šè¿‡å®ç°nopçš„å°é€å™¨/è§£å°å™¨æ¥å£æ¥è§£å†³ã€‚</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="f50d" class="mb kp if lx b fv mc md l me mf">// stack.go<br/><br/>type Stack struct {<br/>	Callers []uintptr<br/>}<br/><br/>func (t Stack) Marshal() ([]byte, error) {<br/>	return nil, nil<br/>}<br/><br/>func (t *Stack) MarshalTo(data []byte) (n int, err error) {<br/>	return 0, nil<br/>}<br/><br/>func (t *Stack) Unmarshal(data []byte) error {<br/>	return nil<br/>}<br/><br/>func (t Stack) MarshalJSON() ([]byte, error) {<br/>	return []byte(`null`), nil<br/>}<br/><br/>func (t *Stack) UnmarshalJSON(data []byte) error {<br/>	return nil<br/>}<br/><br/>func (t *Stack) Size() int {<br/>	return 0<br/>}</span></pre><p id="58ca" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">æˆ‘ä»<a class="ae lr" href="https://github.com/upspin/upspin/blob/master/errors/errors.go" rel="noopener ugc nofollow" target="_blank"> upspin </a>é‚£é‡Œçªƒå–äº†<a class="ae lr" href="https://github.com/travisjeffery/grpc-go-kit-error-example/blob/master/error.go#L67-L163" rel="noopener ugc nofollow" target="_blank">å¡«å……å’Œæ‰“å°å †æ ˆè·Ÿè¸ª</a>çš„ä»£ç ï¼Œåæ­£å¤§éƒ¨åˆ†éƒ½æ˜¯è¿™æ ·ã€‚å½“ç”¨WrapErrå’ŒEå‡½æ•°åˆ›å»ºé”™è¯¯å¹¶ç”¨Error()å‡½æ•°æ‰“å°é”™è¯¯æ—¶ï¼Œå †æ ˆè¢«å¡«å……ã€‚å¦‚æœæ‚¨æƒ³è¦ä¸€ä¸ªæ²¡æœ‰å †æ ˆè·Ÿè¸ªçš„é”™è¯¯ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è‡ªå·±å®ä¾‹åŒ–ä¸€ä¸ªã€‚</p><p id="fd23" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">WrapErrç±»ä¼¼äºæˆ´å¤«Â·åˆ‡å°¼çš„<a class="ae lr" href="https://github.com/pkg/errors/blob/master/errors.go#L180" rel="noopener ugc nofollow" target="_blank">é”™è¯¯ã€‚åŒ…è£…</a>ï¼Œæ¥å—ä¸€ä¸ªé”™è¯¯å¹¶ç”¨æ¶ˆæ¯åŒ…è£…å®ƒã€‚æˆ‘åœ¨ä»£ç çš„æœ€åº•å±‚ä½¿ç”¨WrapErræ¥æ³¨é‡Šç”±stdlibæˆ–ç¬¬ä¸‰æ–¹pkgè¿”å›çš„é”™è¯¯ã€‚Eæ¥å—å„ç§ç±»å‹çš„å‚æ•°åˆ—è¡¨ï¼Œå¹¶å®ä¾‹åŒ–ç›¸åº”çš„é”™è¯¯ï¼Œä¾‹å¦‚E(â€œæ‰¾ä¸åˆ°ç”¨æˆ·â€ï¼Œ404)ä¼šå°†å­—ç¬¦ä¸²ä¸é”™è¯¯æ¶ˆæ¯åŒ¹é…ï¼Œå°†intä¸é”™è¯¯ä»£ç åŒ¹é…ã€‚</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="2699" class="mb kp if lx b fv mc md l me mf">// error.go<br/><br/>// WrapErr returns an Error for the given error and msg.<br/>func WrapErr(err error, msg string) error {<br/>	if err == nil {<br/>		return nil<br/>	}<br/>	e := &amp;Error{Message: fmt.Sprintf("%s: %s", msg, err.Error())}<br/>	e.populateStack()<br/>	return e<br/>}<br/><br/>// E is a useful func for instantiating Errors.<br/>func E(args ...interface{}) error {<br/>	if len(args) == 0 {<br/>		panic("call to E with no arguments")<br/>	}<br/>	e := &amp;Error{}<br/>	b := new(bytes.Buffer)<br/>	for _, arg := range args {<br/>		switch arg := arg.(type) {<br/>		case string:<br/>			pad(b, ": ")<br/>			b.WriteString(arg)<br/>		case int32:<br/>			e.Code = arg<br/>		case int:<br/>			e.Code = int32(arg)<br/>		case error:<br/>			pad(b, ": ")<br/>			b.WriteString(arg.Error())<br/>		}<br/>	}<br/>	e.Message = b.String()<br/>	e.populateStack()<br/>	return e<br/>}</span></pre><h1 id="8ede" class="ko kp if bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">ç”¨é”™è¯¯å­—æ®µå“åº”</h1><p id="a945" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">é€šè¿‡åœ¨æ¯ä¸ªå“åº”ä¸Šæ”¾ç½®ä¸€ä¸ªé”™è¯¯å­—æ®µï¼Œå°†é”™è¯¯å…¬å¼€ç»™å…¶ä»–æœåŠ¡ã€‚åœ¨æœåŠ¡çš„è¾¹ç¼˜ï¼Œå³ç«¯ç‚¹ï¼Œé”™è¯¯çš„ç±»å‹è¢«æ–­è¨€å¹¶åœ¨å“åº”ä¸­è®¾ç½®ã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªHTTPæœåŠ¡ä½œä¸ºgRPCæœåŠ¡çš„ç½‘å…³ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨RPCçš„é”™è¯¯ä»£ç æ¥è®¾ç½®HTTPå“åº”çš„çŠ¶æ€ä»£ç ã€‚</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="2b29" class="mb kp if lx b fv mc md l me mf">// example.proto<br/><br/>service Users {<br/>  rpc GetUser (GetUserRequest) returns (GetUserResponse) {}<br/>}<br/><br/>message GetUserResponse {<br/>  User user = 1;<br/>  Error error = 2;<br/>}<br/><br/>// endpoints.go<br/><br/>func makeGetUserEndpoint(userService user.Service) endpoint.Endpoint {<br/>    return func(ctx context.Context, request interface{}) (interface{}, error) {<br/>        req := request.(*GetUserRequest)<br/>        user, err := userService.GetUser(req.User)<br/>        if err != nil {<br/>            return &amp;GetUserResponse{Error: err.(*Error)}, nil<br/>        }<br/>        return &amp;GetUserResponse{User: user}, nil<br/>    }<br/>}<br/><br/>// transport.go<br/><br/>r.Methods("GET").Handle("/users/{id}", httptransport.NewServer(<br/>    endpoints.GetUserEndpoint,<br/>    decodeGetUserRequest,<br/>    encodeResponse,<br/>    options...,<br/>))<br/><br/>type errorer interface {<br/>    GetError() *example.Error<br/>}<br/><br/>func encodeResponse(ctx context.Context, w http.ResponseWriter, response interface{}) error {<br/>    if e, ok := response.(errorer); ok {<br/>        if err := e.GetError(); err != nil {<br/>            w.WriteHeader(int(err.Code))<br/>        }<br/>    }<br/>    w.Header().Set("Content-Type", "application/json; charset=utf-8")<br/>    return json.NewEncoder(w).Encode(response)<br/>}</span></pre><h1 id="42ea" class="ko kp if bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">ä¸€èµ·çœ‹</h1><p id="b1d5" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">æˆ‘å·²ç»å°†ä¸€ä¸ª<a class="ae lr" href="https://github.com/travisjeffery/grpc-go-kit-error-example" rel="noopener ugc nofollow" target="_blank">ä¾‹å­æ¨é€åˆ°GitHub </a>ä¸Šï¼Œè¿™æ ·ä½ å°±å¯ä»¥æ£€æŸ¥æ‰€æœ‰çš„ä¸œè¥¿äº†ã€‚</p><p id="9fbf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">è¿™ä¸ªå·¥ä½œæµç¨‹å¾ˆæ£’ï¼Œä½†æ˜¯å¦‚æœä½ æœ‰æ›´å¥½çš„æ„è§ï¼Œæˆ‘æƒ³å¬å¬ã€‚</p><h1 id="98ef" class="ko kp if bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">ä¸ºä»€ä¹ˆä¸å…ƒæ•°æ®/è¿”å›é”™è¯¯ç»™gRPC</h1><p id="78a6" class="pw-post-body-paragraph jc jd if je b jf lm jh ji jj ln jl jm jn lo jp jq jr lp jt ju jv lq jx jy jz hn dt translated">æˆ‘å°è¯•ç¼–å†™ä¸€ä¸ªAPIï¼Œå°†é”™è¯¯è¿”å›ç»™gRPCï¼Œè€Œä¸æ˜¯è®¾ç½®åœ¨å“åº”ä¸­ã€‚æœåŠ¡å™¨ä¸Šçš„ä¸­é—´ä»¶å°†æŠŠé”™è¯¯ç¼–ç æˆ<a class="ae lr" href="https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md" rel="noopener ugc nofollow" target="_blank">å…ƒæ•°æ®</a>ï¼Œå®¢æˆ·æœºä¸Šçš„ä¸­é—´ä»¶å°†è§£ç é”™è¯¯å¹¶è¿”å›ï¼Œä½¿gRPCè°ƒç”¨å®Œå…¨åƒæœ¬åœ°å‡½æ•°è°ƒç”¨ä¸€æ ·å·¥ä½œã€‚</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="6248" class="mb kp if lx b fv mc md l me mf">// example.proto</span><span id="e1c6" class="mb kp if lx b fv mq md l me mf">service Users {<br/>  rpc GetUser (GetUserRequest) returns (GetUserResponse) {}<br/>}</span><span id="9365" class="mb kp if lx b fv mq md l me mf">message GetUserResponse {<br/>  User user = 1;<br/>  // Error's gone<br/>}</span><span id="c8a8" class="mb kp if lx b fv mq md l me mf">// endpoints.go</span><span id="a930" class="mb kp if lx b fv mq md l me mf">func makeGetUserEndpoint(userService user.Service) endpoint.Endpoint {<br/>    return func(ctx context.Context, request interface{}) (interface{}, error) {<br/>        req := request.(*GetUserRequest)<br/>        user, err := userService.GetUser(req.User)<br/>        if err != nil {<br/>            return nil, err<br/>        }<br/>        return &amp;GetUserResponse{User: user}, nil<br/>    }<br/>}</span><span id="41bb" class="mb kp if lx b fv mq md l me mf">// client.go<br/>resp, err := usersClient.GetUser(ctx, &amp;GetUserRequest{Email: "email@example.com"})<br/>if err != nil {<br/>    ...<br/>}</span></pre><p id="2eee" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">é—®é¢˜åœ¨äº<a class="ae lr" href="https://github.com/go-kit/kit/blob/0c52d4024a04395dabac42b65e5825d08d3335df/transport/grpc/server.go#L91-L95" rel="noopener ugc nofollow" target="_blank"> go-kitæ²¡æœ‰ç»™ä½ æœºä¼šå°†é”™è¯¯ç¼–ç åˆ°ä¸Šä¸‹æ–‡</a>ä¸­ã€‚å¦‚æœæ‚¨çš„ç«¯ç‚¹è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œgo-kitå°†ç›´æ¥å°†å…¶å‘é€ç»™gRPCï¼ŒgRPCå°†åªçŸ¥é“è·å–é”™è¯¯çš„error()å­—ç¬¦ä¸²ï¼Œè€Œå¿½ç•¥å…¶ä½™çš„æ•°æ®ã€‚ä¸æ”¯æŒè¿™ä¸€ç‚¹çš„ç¼ºç‚¹æ˜¯æ‚¨çš„å®¢æˆ·ç«¯åœ¨å‘å‡ºè¯·æ±‚æ—¶å¿…é¡»æ£€æŸ¥ä¸¤ä¸ªé”™è¯¯ï¼Œè¿”å›çš„é”™è¯¯å’Œè¯·æ±‚é”™è¯¯ã€‚æˆ‘æ›´å¸Œæœ›go-kitæ”¯æŒå®ƒï¼Œä½†å®ƒä¼¼ä¹æ˜¯<a class="ae lr" href="https://github.com/go-kit/kit/issues/283" rel="noopener ugc nofollow" target="_blank">ä¸ä¼šå‘ç”Ÿã€‚</a></p><p id="856d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt">â€“</p><p id="0059" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">è¯·åœ¨<a class="ae lr" href="https://twitter.com/travisjeffery" rel="noopener ugc nofollow" target="_blank"> @travisjeffery </a>é—®å¥½ã€‚</p><p id="1921" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">å‡»ä¸­è¦å®³ğŸ‘å¦‚æœä½ è§‰å¾—è¿™ä¸ªæœ‰ç”¨ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚</p><p id="0420" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">è°¢è°¢ä½ çš„é˜…è¯»ã€‚</p><figure class="ls lt lu lv fq hw"><div class="bz el l di"><div class="mr ms l"/></div></figure></div></div>    
</body>
</html>