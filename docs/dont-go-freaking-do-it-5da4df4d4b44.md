# ä¸è¦â€œå»ä»–å¦ˆçš„åšå§â€â€”â€”èªæ˜çš„åˆåŒåˆ†æ

> åŸæ–‡ï¼š<https://medium.com/hackernoon/dont-go-freaking-do-it-5da4df4d4b44>

![](img/052abbccc65bf37d642c906cdad57062.png)

åˆšåˆšåœ¨[é»‘å®¢æ–°é—»](https://news.ycombinator.com/item?id=15843738)ä¸Šçœ‹åˆ°ä¸€ä¸ªå…³äºä¸€ä¸ªå«åšâ€œ[å»ä»–å¦ˆçš„åšå§](https://gofreakingdoit.com/)â€çš„[ä»¥å¤ªåŠ](https://www.ethereum.org/)æ™ºèƒ½åˆçº¦çš„å¥½ä¸»æ„ï¼Œäºæ˜¯å†³å®šçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚è¿™ç¯‡æ–‡ç« æè¿°äº†æˆ‘ä»¬å‘ç°çš„ä¸€äº›é”™è¯¯ã€‚

# ä»‹ç»

æˆ‘çš„æœ‹å‹ [Nico](https://hamstah.com/) å’Œ [I](https://tandem.engineering) éƒ½å¯¹ä¿¡æ¯/ç½‘ç»œå®‰å…¨æ„Ÿå…´è¶£ï¼Œæœ€è¿‘æ³¨æ„åˆ°æ™ºèƒ½åˆåŒä¸­å¯ç”¨çš„æ”»å‡»é¢ã€‚ç›®å‰ï¼Œæˆ‘ä»¬ä¸»è¦ç€çœ¼äºå¯é æ€§å’Œ EVM å­—èŠ‚ç ï¼Œè¯•å›¾è‡ªåŠ¨åŒ–å¯»æ‰¾æ¼æ´çš„è¿‡ç¨‹ï¼Œä»¥åŠåšä¸€äº›æ‰‹å·¥ä»£ç å®¡è®¡ã€‚

è¯¥åˆåŒçš„ä»£ç åœ¨ Etherscan ä¸Š[ï¼Œå¯ä»¥ç›´æ¥åœ¨é‚£é‡Œè¿›è¡Œå®¡è®¡ã€‚å¦‚æœä½ å¯¹å¯é æ€§ä¸ç†Ÿæ‚‰ï¼Œçœ‹çœ‹è¿™ä¸ªå¤‡å¿˜å•](https://etherscan.io/address/0x2d4991d05131cbf3cdf81439e96b11a93ccb7af0#code)ã€‚æ„Ÿè°¢åˆåŒçš„ä½œè€… Karolis Ramanauskas ï¼Œä»–æ‰§è¡Œäº†ä¸€ä¸ªå¦‚æ­¤å·§å¦™çš„æƒ³æ³•ã€‚

# ä»€ä¹ˆæ˜¯â€œå»ä»–å¦ˆçš„åšå§â€

è¿™ä¸ªæ¦‚å¿µå¾ˆç®€å•:ä½ æŠŠ$$$å’Œä½ æƒ³è¦å®Œæˆçš„ç›®æ ‡ä¸€èµ·å­˜å…¥åˆåŒï¼Œè¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„â€œä¸»ç®¡â€è”ç³»äººï¼Œä»–å°†æ ¸å®ä½ æ˜¯å¦åœ¨ç»™å®šçš„æ—¥æœŸå®Œæˆäº†ç›®æ ‡ã€‚å¦‚æœä»–ä»¬è¯´ä½ åšåˆ°äº†ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ‹¿å›ä½ çš„ç¾å…ƒã€‚å¦‚æœæ²¡æœ‰ï¼Œâ€œå»ä»–å¦ˆçš„åšå§â€ä¼šä¿ç•™å®ƒï¼Œæ‰€æœ‰è€…ä¼šä¸ºä»–ä»¬å»ºé€ å®ƒçš„åŠªåŠ›èµšäº›é’±ã€‚

# å‘ç°ä½ä¸¥é‡æ€§é—®é¢˜

**æ•°æ®ä¸¢å¤±ã€‚**ä¸æ£€æŸ¥ç›®æ ‡æ˜¯å¦å·²ç»åŒ…å«ç»™å®šçš„æ•£åˆ—ã€‚å¦‚æœæäº¤äº†å…·æœ‰ç›¸åŒå‘ä»¶äºº/æè¿°/ä»·å€¼/æˆªæ­¢æ—¥æœŸçš„ç›®æ ‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç›®æ ‡ä¸¢å¤±(å’Œ$$$)ã€‚

```
function setGoal() {
    (...snip for brevity...) bytes32 hash = keccak256(msg.sender, _description, msg.value, _deadline); Goal memory goal = Goal(...snip for brevity...); goals[hash] = goal; (...snip for brevity...)
}
```

*è§£å†³æ–¹æ¡ˆ:è¦ä¹ˆæ‹’ç»é‡å¤é¡¹ï¼Œè¦ä¹ˆåœ¨å“ˆå¸Œä¸­æ·»åŠ ä¸€ä¸ªéšæœºæ•°ã€‚*

ä¸€ä¸ªè¶…çº§ç”¨æˆ·è´Ÿè´£æ‰€æœ‰ä»»åŠ¡ã€‚ è¿™ä¸ªå¥‘çº¦æœ‰ä¸¤ç±»ç”¨æˆ·ï¼Œâ€œæ‰€æœ‰è€…â€å’Œå…¶ä»–æ‰€æœ‰äººã€‚è¿™æ ·åšçš„é—®é¢˜æ˜¯ï¼Œå¥‘çº¦æœ‰ä¸€äº›å†…åŠ¡å¤„ç†åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¯èƒ½è¿è¡Œåœ¨æŸä¸ªå¤–éƒ¨ç³»ç»Ÿä¸Š(æ¯”å¦‚ setEmailSent())ï¼Œç„¶åè¿™ä¸ªç³»ç»Ÿå°†å¯ä»¥è®¿é—®å‡­è¯ï¼Œè¿™äº›å‡­è¯å¯ä»¥å¯¹å¥‘çº¦åšä»»ä½•äº‹æƒ…ã€‚(è™¹å¸é’±ï¼Œè½¬ç§»æ‰€æœ‰æƒï¼Œé”€æ¯å®ƒã€‚).

*è§£å†³æ–¹æ¡ˆ:æœ€å¥½å°†æƒé™åˆ†å±‚ï¼Œå¹¶æœ‰ä¸€ä¸ªé¢å¤–çš„å¸æˆ·ï¼Œâ€œä¼šè®¡â€æˆ–ç±»ä¼¼çš„å¸æˆ·ã€‚*

**æ•°æ®æ³„éœ²ã€‚**å› ä¸ºæ‰€æœ‰ç›®æ ‡éƒ½æ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç”¨æˆ·è¾“å…¥çš„ç”µå­é‚®ä»¶åœ°å€ã€ç›®æ ‡å’Œé‡‘é¢ã€‚

```
Goal[] public activeGoals;
```

*è§£å†³æ–¹æ¡ˆ:ä¸è¦æ ‡è®°ä¸º publicã€‚*

# **å‘ç°é«˜ä¸¥é‡æ€§é—®é¢˜**

**ä¸å…è®¸å°†ç›®æ ‡è®¾ç½®ä¸ºå¤±è´¥ã€‚setGoalFailed ç¼ºå°‘â€œonlyOwnerâ€ä¿æŠ¤ã€‚è¿™æ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥åœ¨ä»»ä½•æ—¶å€™â€œè¾œè´Ÿâ€åˆåŒä¸­æ¯ä¸ªç”¨æˆ·çš„ç›®æ ‡ï¼Œå®è´¨ä¸Šæ˜¯å°†ä»–ä»¬æ‰€æœ‰çš„é’±éƒ½æç»™äº†åˆåŒæ‰€æœ‰è€…ã€‚**

```
function setGoalFailed(uint _index, bytes32 _hash) {
    assert(goals[_hash].amount > 0);
    // assert(goals[_hash].emailSent == true); goals[_hash].completed = false;
    activeGoals[_index].completed = false; owner.transfer(goals[_hash].amount); // send ether to contract owner setGoalFailedEvent(_hash, false);
}
```

*è§£å†³æ–¹æ¡ˆ:åœ¨å‡½æ•°å£°æ˜ä¸­æ·»åŠ  onlyOwner å®ˆæŠ¤ã€‚*

**æ²¡æœ‰ç‰ˆæœ¬æ§åˆ¶æˆ–å‡çº§çš„å¯èƒ½æ€§ã€‚**å› ä¸ºæ‰€æœ‰çš„çŠ¶æ€éƒ½å­˜å‚¨åœ¨å¥‘çº¦æœ¬èº«ä¸­ï¼Œæ‰€ä»¥å‡çº§æ˜¯ä¸å¯èƒ½çš„ã€‚

*è§£å†³æ–¹æ¡ˆ:æ‹¥æœ‰ç‹¬ç«‹çš„ä¸šåŠ¡å’Œæ•°æ®é€»è¾‘ï¼Œæˆ–è€…ä½¿ç”¨ delegatecall ä¼šæœ‰æ‰€å¸®åŠ©ã€‚å‚è§* [*æ­¤å¤„*](https://blog.colony.io/writing-upgradeable-contracts-in-solidity-6743f0eecc88) *å’Œ* [*æ­¤å¤„*](/aigang-network/upgradable-smart-contracts-what-weve-learned-at-aigang-b181d3d4b668) *å…³äºå¯å‡çº§åˆåŒçš„ç²¾å½©æ–‡ç« ã€‚*

# æˆ‘ä»¬æ˜¯è°

è‹±å›½ä¼¦æ•¦çš„ä¸¤åé‡‘èç§‘æŠ€é¦–å¸­æŠ€æœ¯å®˜ã€‚

æ›´å¤šå…³äº[æ°æ–¯ç€](https://tandem.engineering) |æ›´å¤šå…³äº[å°¼ç§‘](https://hamstah.com)ã€‚

# ç¬”è®°

åœ¨å‘è¡¨è¿™ç¯‡å¸–å­å‰ä¸ä¹…ï¼ŒHN [ä¸Šçš„ç”¨æˆ·â€œmpegâ€å‘ç°äº†åŒæ ·çš„ setGoalFailed() bug](https://news.ycombinator.com/item?id=15845374) ã€‚

# æ›´æ–°

å¥½æ¶ˆæ¯ï¼ğŸ˜ä½œè€…æŒ‡å‡ºï¼Œä»–æ­£åœ¨ç ”ç©¶ V2ï¼Œå¹¶å°†è§£å†³æ‚¬è€Œæœªå†³çš„é—®é¢˜ã€‚