<html>
<head>
<title>Testing our iOS networking layer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æµ‹è¯•æˆ‘ä»¬çš„iOSç½‘ç»œå±‚</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/hackernoon/unit-testing-our-ios-network-layer-d0a83172aa66?source=collection_archive---------3-----------------------#2017-02-24">https://medium.com/hackernoon/unit-testing-our-ios-network-layer-d0a83172aa66?source=collection_archive---------3-----------------------#2017-02-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><h1 id="5ab8" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">ä¸ºä»€ä¹ˆï¼Ÿ</h1><p id="9c50" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">åœ¨è¿‡å»çš„ä¸€å‘¨é‡Œï¼Œæˆ‘ä¸€ç›´åœ¨WeVaté‡æ„æˆ‘ä»¬çš„ç½‘ç»œå±‚ã€‚å¯¹äºå¯èƒ½ç”±<a class="ae kn" href="https://hackernoon.com/tagged/network" rel="noopener ugc nofollow" target="_blank">ç½‘ç»œ</a>å¼•èµ·çš„é”™è¯¯åœºæ™¯çš„å•å…ƒæµ‹è¯•è¦†ç›–ç‡éå¸¸ä½ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæ’’ä¸‹æ›´å¤§ç½‘çš„å¥½æœºä¼šï¼Œä»¥ç¡®ä¿æˆ‘ä»¬çš„ç½‘ç»œé‡æ„ä¸ä¼šå¼•å…¥ä»»ä½•éº»çƒ¦ğŸã€ğŸ•·æˆ–ğŸœå—</p><p id="ac47" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">ä¸‹é¢æˆ‘å°†ç®€è¦è§£é‡Šæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„å•å…ƒæµ‹è¯•å¥—ä»¶ï¼Œç„¶åå°†è½¬ç§»åˆ°æˆ‘ä»¬å¦‚ä½•åœ¨ä¸ç¼–å†™å¤§é‡ä»£ç çš„æƒ…å†µä¸‹åŠ¨æ€æµ‹è¯•å¤šä¸ªé”™è¯¯åœºæ™¯ã€‚</p><h1 id="e37a" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">æ–¹æ³•</h1><p id="c39c" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated"><strong class="jr hv">ohhttpsubs</strong></p><p id="8dce" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">æˆ‘åœ¨ä»¥å‰çš„ä¸€ä¸ªé¡¹ç›®ä¸Šä½¿ç”¨è¿‡<a class="ae kn" href="https://github.com/AliSoftware/OHHTTPStubs" rel="noopener ugc nofollow" target="_blank"> OHTTPStubs </a>ï¼Œå®ƒä¼¼ä¹æ˜¯iOSçš„ç½‘ç»œå­˜æ ¹åº“çš„è¡Œä¸šæ ‡å‡†ã€‚å®ƒæä¾›äº†ä¸€å¥—å·¥å…·æ¥å¸®åŠ©æ¸…é™¤ä»»ä½•ä½¿ç”¨<code class="eh kt ku kv kw b">NSURLConnection, NSURLSession</code>æˆ–<code class="eh kt ku kv kw b">Alamofire</code>è¿›è¡Œçš„ç½‘ç»œè°ƒç”¨ï¼Œå› æ­¤éå¸¸é€‚åˆæˆ‘ä»¬è¿™é‡Œçš„éœ€æ±‚ã€‚</p><p id="9f86" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">æˆ‘è¿˜åœ¨åº“å‘¨å›´åˆ›å»ºäº†ä¸€ä¸ªå°åŒ…è£…å™¨ï¼Œä»¥æˆ‘ä»¬éœ€è¦çš„æ–¹å¼å‘æˆ‘ä»¬æä¾›æ‰€æœ‰çš„å­˜æ ¹ä»£ç ã€‚</p><p id="59a1" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">ä¸‹é¢çš„æ–¹æ³•è®©æˆ‘ä»¬èƒ½å¤Ÿç”¨ä¸€ä¸ª200å’Œä¸€ä¸ªå®šä¹‰å¥½çš„<a class="ae kn" href="https://hackernoon.com/tagged/json" rel="noopener ugc nofollow" target="_blank"> JSON </a>å“åº”æ¥è¿æ¥ç½‘ç»œã€‚</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="4dca" class="lf is hu kw b fv lg lh l li lj">static func stubNetwork(forService service: Service.Type) {</span><span id="c8b8" class="lf is hu kw b fv lk lh l li lj">     stub(condition: isHost(baseUrl)) { _ in<br/>          guard let path = OHPathForFileInBundle(stubPath(forService: service), Bundle.main) else {<br/>      preconditionFailure(â€œStub not found!â€)<br/>     }</span><span id="c1f5" class="lf is hu kw b fv lk lh l li lj">      return OHHTTPStubsResponse(<br/>         fileAtPath: path,<br/>         statusCode: 200,<br/>         headers: [ â€œContent-Typeâ€: â€œapplication/jsonâ€ ]<br/>        )<br/>     }<br/>}</span></pre><p id="f5f7" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">æˆ‘ä¼šè§£é‡Šè¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆ</p><ol class=""><li id="368a" class="ll lm hu jr b js ko jw kp ka ln ke lo ki lp km lq lr ls lt dt translated">æˆ‘ä»¬ä¼ å…¥æˆ‘ä»¬æƒ³è¦å­˜æ ¹çš„æœåŠ¡ç±»å‹ã€‚æœåŠ¡æ˜¯ä¸€ç§åè®®ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æœåŠ¡éƒ½éµå¾ªè¿™ç§åè®®ã€‚è¿™æä¾›äº†åˆ‡æ¢æœåŠ¡çš„èƒ½åŠ›ã€‚é”®å…¥å¹¶æä¾›æ¯ä¸ªæœåŠ¡æ‰€éœ€çš„å­˜æ ¹æ•°æ®ã€‚</li><li id="7ab5" class="ll lm hu jr b js lu jw lv ka lw ke lx ki ly km lq lr ls lt dt translated">æˆ‘ä»¬ç»™å­˜æ ¹ä¸€ä¸ªæ¡ä»¶ã€‚è¿™å°†æ˜¯æˆ‘ä»¬æƒ³è¦å­˜æ ¹çš„ä¸»æœºurlã€‚å®ƒå°†å­˜æ ¹ä»»ä½•è¯·æ±‚ä¸è¿™ä¸ªç½‘å€ã€‚</li><li id="74aa" class="ll lm hu jr b js lu jw lv ka lw ke lx ki ly km lq lr ls lt dt translated">æˆ‘ä»¬è·å¾—æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼Œè¯¥è·¯å¾„ä¿å­˜å“åº”çš„JSONæ•°æ®ã€‚</li><li id="caa5" class="ll lm hu jr b js lu jw lv ka lw ke lx ki ly km lq lr ls lt dt translated">è¿”å›è¿™ä¸ªæ–‡ä»¶ï¼Œæ¸…é™¤æ‰€æœ‰ä½¿ç”¨è¿™ä¸ªurlçš„è¯·æ±‚ï¼Œç›´åˆ°ä½¿ç”¨<code class="eh kt ku kv kw b">OHHTTPStubs.removeAllStubs()</code>åˆ é™¤è¿™ä¸ªå­˜æ ¹ã€‚</li></ol><p id="2d0c" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated"><strong class="jr hv">æ•æ·</strong></p><p id="fd24" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">æˆ‘ä»¬é€‰æ‹©å‡å°‘ä½¿ç”¨XCTestæä¾›çš„ä¸€äº›æ›´å†—é•¿çš„è¯­æ³•å’Œç¼–ç ç»“æ„ï¼Œå¹¶ç»§ç»­ä½¿ç”¨<a class="ae kn" href="https://github.com/Quick/Nimble" rel="noopener ugc nofollow" target="_blank"> Nimble </a>æ¡†æ¶ã€‚</p><p id="520c" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">è¿™è®©æˆ‘ä»¬ä»å»ºç«‹æœŸæœ›</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="39c8" class="lf is hu kw b fv lg lh l li lj">let expect = expectation(description: â€œGet Receiptsâ€)<br/>...<br/>expect.fulfill()<br/>...<br/>waitForExpectations(timeout: 2) { (error) in<br/>    XCTAssertTrue(asyncReceipts?.count &gt; 0)<br/>}</span></pre><p id="41e4" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">ç®€å•æ¥è¯´:</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="28a8" class="lf is hu kw b fv lg lh l li lj">expect(asyncReceipts!.count &gt; 0).toEventually(beTrue())</span></pre><p id="b493" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt">ğŸ‘ğŸ»ğŸ‘ğŸ»ğŸ‘ğŸ»</p><p id="9201" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated"><strong class="jr hv">æµ‹è¯•ğŸ™‚è·¯å¾„</strong></p><p id="6ef7" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">è¿™åº”è¯¥åœ¨å•ä¸ªæµ‹è¯•æ¡ˆä¾‹ä¸­å¾—åˆ°è¯æ˜ã€‚åªéœ€è®¾ç½®æˆåŠŸå­˜æ ¹ï¼Œè°ƒç”¨æœåŠ¡å¹¶æ–­è¨€å¼‚æ­¥ç»“æœå·²ç»å®ç°ã€‚</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="18dc" class="lf is hu kw b fv lg lh l li lj">var asyncReceipts: [Receipts]?<br/>StubHelper.stubNetwork(forService: GetReceiptsService.self)</span><span id="1917" class="lf is hu kw b fv lk lh l li lj">GetReceiptsService.getReceipts(forUser: UUID().uuidString) { (result) in</span><span id="5870" class="lf is hu kw b fv lk lh l li lj">     switch result {<br/>     case .success(let receipts):<br/>          asyncReceipts = receipts<br/>     default: break<br/>     }<br/>}</span><span id="62ce" class="lf is hu kw b fv lk lh l li lj">expect(asyncReceipts).toEventuallyNot(beNil())<br/>expect(asyncReceipts!.count &gt; 0).toEventually(beTrue())</span></pre><p id="1aa4" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated"><strong class="jr hv">æµ‹è¯•ğŸ™è·¯å¾„</strong></p><p id="44b3" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">è¿™æ˜¯å•å…ƒæµ‹è¯•çœŸæ­£å¼€å§‹è¯æ˜å…¶ä»·å€¼çš„åœ°æ–¹ã€‚</p><p id="2729" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">æˆ‘ä»¬å¯ä»¥ç±»ä¼¼åœ°ä¸ºç½‘ç»œè°ƒç”¨ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„é”™è¯¯ä»£ç è®¾ç½®å­˜æ ¹ï¼Œè°ƒç”¨æœåŠ¡ï¼Œå¹¶æ–­è¨€é”™è¯¯æ˜¯å¼‚æ­¥è®¾ç½®çš„ã€‚</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="ee40" class="lf is hu kw b fv lg lh l li lj">var asyncError: Error?<br/>stubNetworkWithNoConnection()</span><span id="71a3" class="lf is hu kw b fv lk lh l li lj">GetReceiptsService.getReceipts(forUser: â€œâ€) { (result) in</span><span id="9f4f" class="lf is hu kw b fv lk lh l li lj">    switch result {<br/>    case .failure(let error):<br/>         asyncError = error<br/>    default: break<br/>    }<br/>}</span><span id="2c51" class="lf is hu kw b fv lk lh l li lj">expect(asyncError).toEventuallyNot(beNil())<br/>expect(asyncError as! HTTPError).toEventually(equal(HTTPError.noConnection))</span></pre><p id="1c06" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">å¤ªé…·äº†ã€‚ä½†æˆ‘å¬åˆ°ä½ è¯´ï¼Œè¿™ä¼¼ä¹å¯ä»¥ä¼˜åŒ–ã€‚æˆ‘ä»¬ä¸æƒ³æ¯æ¬¡æµ‹è¯•ä¸åŒçš„é”™è¯¯æ—¶éƒ½é‡å¤è¿™æ®µä»£ç ã€‚</p><h1 id="75f0" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">è®©æˆ‘ä»¬åè®®</h1><p id="1141" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">å› æ­¤ï¼Œè€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡ä¸Šæµ‹è¯•æ¥è‡ªæœåŠ¡å™¨çš„æ¯ä¸ªå¯èƒ½çš„é”™è¯¯å“åº”ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ–­è¨€è¿”å›çš„é”™è¯¯æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚</p><p id="fd47" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated"><strong class="jr hv">æœåŠ¡å¯æµ‹è¯•åè®®</strong></p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="5095" class="lf is hu kw b fv lg lh l li lj">protocol ServiceTestable {</span><span id="80ab" class="lf is hu kw b fv lk lh l li lj">     func testFailures()</span><span id="86c2" class="lf is hu kw b fv lk lh l li lj">     func setupNetworkFailureTest(withStub stub: (() -&gt; Void), andErrorToAssert errorAssertion: HTTPError)</span><span id="4c0b" class="lf is hu kw b fv lk lh l li lj">}</span></pre><p id="8333" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">è¿™é‡Œæˆ‘å®šä¹‰äº†ä¸€ä¸ªåè®®ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬å¦‚ä½•æµ‹è¯•æˆ‘ä»¬çš„æœåŠ¡ç±»æä¾›ä¸€ä¸ªå·¥å…·ã€‚é€šè¿‡ç¡®ä¿æˆ‘ä»¬çš„æœåŠ¡ç¬¦åˆè¿™ä¸ªåè®®ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨<code class="eh kt ku kv kw b">testFailures()</code>ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬éœ€è¦çš„æ¯ä¸ªåœºæ™¯è°ƒç”¨<code class="eh kt ku kv kw b">setupNetworkFailureTest()</code>å‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å­˜æ ¹å’Œæˆ‘ä»¬æƒ³è¦æ–­è¨€çš„é”™è¯¯æ³¨å…¥åˆ°æµ‹è¯•ä¸­ã€‚</p><p id="83a0" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">ç°åœ¨ä½ é—®çš„å®ç°åœ¨å“ªé‡Œï¼Ÿç­‰ä¸€ä¸‹ï¼Œæˆ‘å‘Šè¯‰ä½ ï¼</p><p id="edbc" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated"><strong class="jr hv">è¾“å…¥åè®®æ‰©å±•</strong></p><p id="9374" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">é€šè¿‡æ‰©å±•æˆ‘ä»¬çš„<code class="eh kt ku kv kw b">ServiceTestable</code>åè®®ï¼Œæˆ‘ä»¬å¯ä»¥ç»™æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹ä¸€äº›é»˜è®¤è¡Œä¸ºã€‚</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="4411" class="lf is hu kw b fv lg lh l li lj">extension ServiceTestable where Self: WeVatTests {</span><span id="ebc1" class="lf is hu kw b fv lk lh l li lj">func testFailuresWithStatusCodes() {<br/>         let failures = [</span><span id="7a98" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkWithNotFound, error: HTTPError.notFound),</span><span id="b6a5" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkWithForbidden, error: HTTPError.invalidCredentials),</span><span id="7b28" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkTimeout, error: HTTPError.timeout),</span><span id="39d9" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkNoConnection, error: HTTPError.noConnection),</span><span id="32ed" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkWithBadRequest, error: HTTPError.invalidRequest),</span><span id="e875" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkWithServerError, error: HTTPError.serverError),</span><span id="1985" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkWithUnauthorized, error: HTTPError.invalidCredentials),</span><span id="b591" class="lf is hu kw b fv lk lh l li lj">         (stub: StubHelper.stubNetworkWithServerTimeout, error: HTTPError.timeout)</span><span id="5fe6" class="lf is hu kw b fv lk lh l li lj">           ]</span><span id="783a" class="lf is hu kw b fv lk lh l li lj">         for failure in failures {</span><span id="434b" class="lf is hu kw b fv lk lh l li lj">              setupNetworkFailureTest(withStub: failure.stub, andErrorToAssert: failure.error)</span><span id="0aa3" class="lf is hu kw b fv lk lh l li lj">         }</span><span id="3c90" class="lf is hu kw b fv lk lh l li lj">    }</span><span id="013c" class="lf is hu kw b fv lk lh l li lj">}</span></pre><p id="d0a5" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">è¿™çœ‹èµ·æ¥åƒä¸€å¤§å—æ—§çš„o 'ä»£ç ï¼Œä½†å®ƒå°†æä¾›ç›¸å½“å¤§çš„ã€‚æˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªå…ƒç»„æ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„å…ƒç´ åŒ…å«</p><ol class=""><li id="a4fd" class="ll lm hu jr b js ko jw kp ka ln ke lo ki lp km lq lr ls lt dt translated">å¯¹æˆ‘ä»¬è¦ä½¿ç”¨çš„å­˜æ ¹çš„å¼•ç”¨ã€‚</li><li id="00d0" class="ll lm hu jr b js lu jw lv ka lw ke lx ki ly km lq lr ls lt dt translated">æˆ‘ä»¬è¦åå¯¹çš„é”™è¯¯ã€‚</li></ol><p id="972f" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">ç°åœ¨ï¼Œç¬¦åˆæˆ‘ä»¬çš„<code class="eh kt ku kv kw b">ServiceTestable</code>åè®®çš„ç±»å°†çœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="kx ky kz la fq lb kw lc ld aw le dt"><span id="21d8" class="lf is hu kw b fv lg lh l li lj">class GetReceiptsServiceTests: WeVatTests, ServiceTestable {</span><span id="0d0a" class="lf is hu kw b fv lk lh l li lj">    override func tearDown() {<br/>        super.tearDown()<br/>        StubHelper.unStubNetwork()<br/>    }</span><span id="04eb" class="lf is hu kw b fv lk lh l li lj">    ...</span><span id="a49a" class="lf is hu kw b fv lk lh l li lj">    func testFailures() {<br/>        testFailuresWithStatusCodes()<br/>    }</span><span id="8344" class="lf is hu kw b fv lk lh l li lj">    func setupNetworkFailureTest(withStub stub: (() -&gt; Void), andErrorToAssert errorAssertion: HTTPError) {</span><span id="a40b" class="lf is hu kw b fv lk lh l li lj">        var asyncError: Error?<br/>        stub()</span><span id="94c7" class="lf is hu kw b fv lk lh l li lj">        GetReceiptsService.getReceipts(forUser: UUID().uuidString) { (result) in</span><span id="9a3e" class="lf is hu kw b fv lk lh l li lj">              switch result {<br/>              case .failure(let error):<br/>                 asyncError = error<br/>              default: break<br/>             }<br/>         }</span><span id="4175" class="lf is hu kw b fv lk lh l li lj">         expect(asyncError).toEventuallyNot(beNil())<br/>         expect(asyncError as! HTTPError).toEventually(equal(errorAssertion))<br/>    }<br/>}</span></pre><p id="9625" class="pw-post-body-paragraph jp jq hu jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hn dt translated">æˆ‘å°†å¸¦ä½ äº†è§£ç°åœ¨çš„æƒ…å†µ:</p><ol class=""><li id="bb48" class="ll lm hu jr b js ko jw kp ka ln ke lo ki lp km lq lr ls lt dt translated">æˆ‘ä»¬ç°åœ¨ç¡®ä¿æœåŠ¡æµ‹è¯•ç±»ç¬¦åˆ<code class="eh kt ku kv kw b">ServiceTestable</code>åè®®</li><li id="55ef" class="ll lm hu jr b js lu jw lv ka lw ke lx ki ly km lq lr ls lt dt translated"><code class="eh kt ku kv kw b">testFailures()</code>åœ¨è¿è¡Œæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•å¥—ä»¶æ—¶è¢«XCTestè°ƒç”¨</li><li id="7beb" class="ll lm hu jr b js lu jw lv ka lw ke lx ki ly km lq lr ls lt dt translated">æˆ‘ä»¬åœ¨åè®®æ‰©å±•ä¸­è°ƒç”¨äº†<code class="eh kt ku kv kw b">testFailuresWithStatusCodes()</code>ã€‚</li><li id="c17f" class="ll lm hu jr b js lu jw lv ka lw ke lx ki ly km lq lr ls lt dt translated">å¯¹äºæˆ‘ä»¬æƒ³è¦çš„æ¯ä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªæ‰©å±•åœ¨è°ƒç”¨æˆ‘ä»¬åœ¨<code class="eh kt ku kv kw b">setupNetworkFailureTest</code>ä¸­çš„å®ç°æ—¶èµ·ä½œç”¨ã€‚</li></ol><h1 id="aac2" class="ir is hu bd it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo dt translated">åŒ…è£¹</h1><p id="f7b9" class="pw-post-body-paragraph jp jq hu jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hn dt translated">æˆ‘ä»¬ç°åœ¨æ‹¥æœ‰çš„æ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„æœåŠ¡å±‚æµ‹è¯•å·¥å…·ã€‚å½“æˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªæœåŠ¡æ—¶ï¼Œå¾ˆå®¹æ˜“å°†å…¶ä¸ServiceTestableåè®®è”ç³»èµ·æ¥ï¼Œè¿™å°†ç¡®ä¿æ‰€æœ‰çš„é”™è¯¯æ¡ˆä¾‹éƒ½å¾—åˆ°å……åˆ†çš„æµ‹è¯•ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ æ›´å¤šçš„é”™è¯¯åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬æ·»åŠ åˆ°æ•°ç»„ä¸­ï¼Œå¹¶å¼•ç”¨å®ƒä»¬å¯¹åº”çš„é”™è¯¯å­˜æ ¹ã€‚</p><blockquote class="lz ma mb"><p id="f340" class="jp jq mc jr b js ko ju jv jw kp jy jz md kq kc kd me kr kg kh mf ks kk kl km hn dt translated"><a class="ae kn" href="http://bit.ly/Hackernoon" rel="noopener ugc nofollow" target="_blank">é»‘å®¢ä¸­åˆ</a>æ˜¯é»‘å®¢å¦‚ä½•å¼€å§‹ä»–ä»¬çš„ä¸‹åˆã€‚æˆ‘ä»¬æ˜¯AMIå®¶åº­çš„ä¸€å‘˜ã€‚æˆ‘ä»¬ç°åœ¨<a class="ae kn" href="http://bit.ly/hackernoonsubmission" rel="noopener ugc nofollow" target="_blank">æ¥å—æŠ•ç¨¿</a>å¹¶ä¹æ„<a class="ae kn" href="mailto:partners@amipublications.com" rel="noopener ugc nofollow" target="_blank">è®¨è®ºå¹¿å‘Š&amp;èµåŠ©</a>æœºä¼šã€‚</p><p id="dca4" class="jp jq mc jr b js ko ju jv jw kp jy jz md kq kc kd me kr kg kh mf ks kk kl km hn dt translated">è¦äº†è§£æ›´å¤šä¿¡æ¯ï¼Œ<a class="ae kn" href="https://goo.gl/4ofytp" rel="noopener ugc nofollow" target="_blank">è¯·é˜…è¯»æˆ‘ä»¬çš„â€œå…³äºâ€é¡µé¢</a> , <a class="ae kn" href="http://bit.ly/HackernoonFB" rel="noopener ugc nofollow" target="_blank">å–œæ¬¢/åœ¨è„¸ä¹¦ç»™æˆ‘ä»¬å‘æ¶ˆæ¯</a>ï¼Œæˆ–è€…ç®€å•åœ°ï¼Œ<a class="ae kn" href="https://goo.gl/k7XYbx" rel="noopener ugc nofollow" target="_blank">å‘æ¨æ–‡/DM @HackerNoonã€‚</a></p><p id="708a" class="jp jq mc jr b js ko ju jv jw kp jy jz md kq kc kd me kr kg kh mf ks kk kl km hn dt translated">å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•…äº‹ï¼Œæˆ‘ä»¬æ¨èä½ é˜…è¯»æˆ‘ä»¬çš„<a class="ae kn" href="http://bit.ly/hackernoonlatestt" rel="noopener ugc nofollow" target="_blank">æœ€æ–°ç§‘æŠ€æ•…äº‹</a>å’Œ<a class="ae kn" href="https://hackernoon.com/trending" rel="noopener ugc nofollow" target="_blank">è¶‹åŠ¿ç§‘æŠ€æ•…äº‹</a>ã€‚ç›´åˆ°ä¸‹ä¸€æ¬¡ï¼Œä¸è¦æŠŠä¸–ç•Œçš„ç°å®æƒ³å½“ç„¶ï¼</p></blockquote><figure class="kx ky kz la fq mg"><div class="bz el l di"><div class="mh mi l"/></div></figure></div></div>    
</body>
</html>