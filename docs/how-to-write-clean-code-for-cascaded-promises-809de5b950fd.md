# å¦‚ä½•ä¸ºçº§è”æ‰¿è¯ºç¼–å†™å¹²å‡€çš„ä»£ç 

> åŸæ–‡ï¼š<https://medium.com/hackernoon/how-to-write-clean-code-for-cascaded-promises-809de5b950fd>

## å…³äºç›¸äº’ä¾èµ–çš„æ‰¿è¯ºçš„æ·±å…¥æŒ‡å¯¼

![](img/a70001f357a6a360b4106f8aa7727997.png)

Photo by [Luis Perdigao](https://unsplash.com/photos/vYo_Arzy_WU?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œæˆ‘ä¸€ç›´åœ¨å¯»æ‰¾ç¼–å†™æ›´å¹²å‡€ä»£ç çš„æ–¹æ³•ã€‚

ä¸€å¹´å‰ï¼Œæˆ‘å‘å¸ƒäº†ä¸€ä¸ªåä¸º [Premiere](https://github.com/pedsmoreira/premiere) çš„åº“ï¼Œæ—¨åœ¨æ–¹ä¾¿ç”¨ Javascript åœ¨å‰ç«¯ä½¿ç”¨ Restful APIsã€‚æˆ‘ç°åœ¨æ­£åœ¨æ„å»ºä¸€ä¸ª v2 ç‰ˆæœ¬çš„åº“ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ³¨æ„åˆ°è¿˜æœ‰è®©ä»£ç æ›´å¹²å‡€çš„ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨æ‰¿è¯ºæ–¹é¢ã€‚

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ä¼šè§£é‡Šæ‰¿è¯ºçš„åŸºç¡€ï¼Œä½†æ˜¯å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ï¼Œçœ‹çœ‹æˆ´å¤«Â·é˜¿åˆ‡åˆ©çš„æ–‡ç« ï¼Œä»–åœ¨è¿™æ–¹é¢åšå¾—å¾ˆå¥½ã€‚

*å…è´£å£°æ˜:å¯»æ‰¾å¼‚æ­¥/ç­‰å¾…ç¤ºä¾‹ï¼Ÿè·³åˆ°æœ€åï¼Œå•å‡»å­˜å‚¨åº“é“¾æ¥ã€‚*

è™½ç„¶æ‰¿è¯ºä¸æ˜¯ HTTP è¯·æ±‚çš„å”¯ä¸€æ€§ï¼Œä½†è¿™æ­£æ˜¯å®ƒä»¬é€šå¸¸çš„ç”¨é€”ï¼Œæ‰€ä»¥è¿™å°†æ˜¯æœ¬æ–‡ç¤ºä¾‹çš„ä¸»é¢˜ã€‚

è®©æˆ‘ä»¬å¼€å§‹å§:

è¿™æ˜¯ä¸€æ®µç›´æˆªäº†å½“çš„ä»£ç ï¼Œå·¥ä½œåšå¾—å¾ˆå¥½ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨ç›¸åŒçš„åŠŸèƒ½ï¼Œå¹¶æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚ç¼“å­˜ï¼Œå®ƒå¯ä»¥å¼€å§‹å˜å¾—å¤æ‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:

å¦‚ä½ æ‰€è§ï¼Œè¿™ä¸ªä¾‹å­ä¸åƒä¸Šä¸€ä¸ªä¾‹å­é‚£æ ·å¹²å‡€ã€‚åšçš„äº‹æƒ…å¤ªå¤šäº†ã€‚å½“ç„¶è¿™ä¸æ˜¯ä¸–ç•Œæœ«æ—¥ï¼Œä½†æ˜¯ç†æƒ³æƒ…å†µä¸‹æ¯ä¸ªå‡½æ•°åº”è¯¥åªåšä¸€ä»¶äº‹ï¼Œæ‰€ä»¥æµ‹è¯•å’Œé‡ç”¨å®ƒæ›´å®¹æ˜“ã€‚

å¦‚æœæˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªçº§åˆ«çš„ç¼“å­˜ï¼Œè¿™ä¸ªé—®é¢˜ä¼šå˜å¾—æ›´åŠ æ˜æ˜¾ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ·»åŠ  Promise ç¼“å­˜(ä»¥é˜²æ­¢å‘å‡ºä¸¤ä¸ªç›¸åŒçš„è¯·æ±‚)å¹¶çœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆæ ·å­çš„:

æˆ‘ä»¬ç¦»â€œåªåšä¸€ä»¶äº‹â€æ›´è¿œäº†ã€‚æˆ‘ä»¬æ·»åŠ åˆ°ä»£ç ä¸­çš„ä¸œè¥¿è¶Šå¤šï¼Œå®ƒå°±ä¼šå˜å¾—è¶Šä¹±ï¼Œä¹Ÿè¶Šéš¾é‡ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å†³å®šåˆ›å»ºä¸€ä¸ª`fetchAndCacheItem`,è¿™å°†è¦æ±‚æˆ‘ä»¬å¤åˆ¶æ‰€æœ‰çš„ä»£ç ã€‚

## åˆ†è§£å®ƒ

åˆ†è§£çš„ç¬¬ä¸€æ­¥æ˜¯å°†äº‹æƒ…åˆ†æˆæ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯ä¸ªåŠŸèƒ½è´Ÿè´£ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬è¦åšçš„æ˜¯åˆ›å»ºä¸‰ä¸ªå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°è´Ÿè´£åšä¸‰ä»¶äº‹æƒ…ä¸­çš„ä¸€ä»¶:

1.  ç¼“å­˜æ‰¿è¯º
2.  ç¼“å­˜ç»“æœ
3.  å–æ•°æ®

è¿™é‡Œçš„ä¸»è¦æŒ‘æˆ˜æ˜¯å°†ä¸€ä¸ªç‰‡æ®µè¿æ¥åˆ°å¦ä¸€ä¸ªç‰‡æ®µï¼Œå› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç‰‡æ®µéƒ½éœ€è¦æ¯æ¬¡éƒ½æ‰§è¡Œ(ä¾‹å¦‚ç¼“å­˜æ—¶)ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æä¾›å¯¹ç¼“å­˜å‡½æ•°çš„å›è°ƒï¼Œä»¥ä¾¿åœ¨ç¼“å­˜ä¸å­˜åœ¨æ—¶è°ƒç”¨å®ƒä»¬ã€‚

ä¸‹é¢æ˜¯ä»£ç :*(ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œéšè—äº†ç¼“å­˜æ–¹æ³•)*

å¥½å¤šäº†å§ï¼Ÿæˆ‘ä»¬ç¡®å®æœ‰æ›´å¤šçš„ä»£ç è¡Œï¼Œä½†æ˜¯é˜…è¯»ç»´æŠ¤è¦å®¹æ˜“å¾—å¤šã€‚å›åˆ°`fetchAndCacheItem`æåˆ°çš„ï¼Œéšç€æˆ‘ä»¬å…³æ³¨ç‚¹çš„åˆ†ç¦»ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹çœ‹åˆ°é‡ç”¨ç›¸åŒåŠŸèƒ½çš„é€”å¾„ã€‚

## ä¸‹ä¸€æ­¥

æˆ‘ä»¬å·²ç»è¾¾åˆ°äº†ä»¤äººæ»¡æ„çš„ç¨‹åº¦ï¼Œä½†æ˜¯å¦‚æœæˆ‘å‘Šè¯‰ä½ æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½å‘¢ï¼Ÿ

çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„æœ€åä¸€ä¸ªå‡½æ•°`fetchAndCacheUser`ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™äº›å‡½æ•°æ˜¯ä»¥ç›¸åçš„æ‰§è¡Œé¡ºåºå£°æ˜çš„ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæ··ä¹±ã€‚æˆ‘ä»¬è¿˜å¿…é¡»å£°æ˜ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œå¹¶ä¸ºæ¯ä¸€æ­¥åˆ†é…ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¼šä½¿ä»£ç å˜å¾—æ··ä¹±ã€‚

ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘åˆ›å»ºäº†`promise-cascade`åº“ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨`promise-cascade`æ—¶`fetchAndCacheUser``å‡½æ•°çš„æ ·å­:

å¦‚ä½ æ‰€è§ï¼Œä»£ç ç°åœ¨æ˜¯æŒ‰ç…§è‡ªç„¶é¡ºåºç¼–å†™çš„ï¼Œæ²¡æœ‰äº†`const ... = () => ...`çš„æ··ä¹±ã€‚

åœ¨ä¸€äº›å¤§é‡ä½¿ç”¨è¿™äº›åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•`PromiseCascade`å¹¶åˆ›å»ºåŠ©æ‰‹æ–¹æ³•ä¼šå¾ˆæœ‰å¸®åŠ©ï¼Œå› æ­¤å¯ä»¥è°ƒç”¨`cascade.something(value1, value2)`è€Œä¸æ˜¯`cascade.push(something.bind(this), value1, value2)`ã€‚ä½ å¯ä»¥åœ¨ GitHub repo ä¸Šçœ‹åˆ°è¿™ä¸ª[çš„ä¾‹å­ã€‚](https://github.com/pedsmoreira/promise-cascade)

æ›´å¤šç»†èŠ‚å’Œä¾‹å­(åŒ…æ‹¬`async`)è¯·æŸ¥çœ‹ GitHubã€‚å¦‚æœä½ å–œæ¬¢å®ƒï¼Œæˆ‘å¾ˆæ„Ÿæ¿€ä½ ç»™å®ƒä¸€ä¸ªğŸŒŸæ˜æ˜Ÿã€‚

[](https://github.com/pedsmoreira/promise-cascade) [## ä½©å…¹è«ç‘æ‹‰/æ— æç€‘å¸ƒ

### JS æ‰¿è¯ºçº§è”å˜å¾—ç®€å•

github.com](https://github.com/pedsmoreira/promise-cascade) 

## â¤ï¸å–œæ¬¢ã€‚åˆ†äº«ä¸€ä¸‹ã€‚ç•™ä¸‹ä½ çš„è¯„è®ºã€‚

åˆ«å¿˜äº†ä¼ æ’­çˆ±ã€‚åŠ å…¥ä½ å–œæ¬¢çš„ï¼Œä¸ä½ çš„æœ‹å‹å’ŒåŒäº‹åˆ†äº«ã€‚ä¹Ÿéå¸¸æ¬¢è¿ä½ åœ¨ä¸‹é¢ç•™ä¸‹ä½ çš„è¯„è®ºã€‚

ä½ å¯ä»¥ç»§ç»­å…³æ³¨æˆ‘åœ¨[twitter.com/pedsmoreira](https://twitter.com/pedsmoreira)ä¸Šåˆ›ä½œçš„ä¸œè¥¿ï¼Œæˆ–è€…è®¢é˜…æˆ‘çš„æ—¶äº‹é€šè®¯:

Don't worry, no spam â¤

## é¢å¤–çš„

å¦‚æœä½ å–œæ¬¢ç”¨çˆ±åˆ¶ä½œçš„è½¯ä»¶ï¼Œæˆ‘æƒ³é‚€è¯·ä½ å‚åŠ  [GitShowcase](http://gitshowcase.com/) ã€‚æ¥è·å¾—ä½ è‡ªå·±çš„æ‘‡æ»šæ˜æ˜Ÿä½œå“é›†ğŸ¤˜ã€‚ *cc* [*ç»´å…‹æ‰˜Â·æ¡‘æ‰˜æ–¯*](https://medium.com/u/f2368f957647?source=post_page-----809de5b950fd--------------------------------)

[](https://www.gitshowcase.com/) [## GitShowcase

### å¼€å‘äººå‘˜ï¼Œåœ¨å³æ’å³ç”¨äº§å“ç»„åˆä¸­å±•ç¤ºæ‚¨çš„æœ€ä½³é¡¹ç›®ã€‚æœ€æ£’çš„æ˜¯ï¼Œå…è´¹çš„ã€‚

www.gitshowcase.com](https://www.gitshowcase.com/)