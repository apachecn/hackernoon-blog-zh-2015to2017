# ä»Šæ—¥æ™¦æ¶©çš„ PSA:ä½¿ç”¨ Conda åœ¨ Mac ä¸Šæ­£ç¡®å®‰è£… Python GDAL

> åŸæ–‡ï¼š<https://medium.com/hackernoon/install-python-gdal-using-conda-on-mac-8f320ca36d90>

## ä¸è¦ pip å®‰è£… gdalï¼Œä¸è¦åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£… GDALã€‚è€Œæ˜¯ç”¨åº·è¾¾ã€‚

è¿™äº›æ˜¯æˆ‘å…³äºå¦‚ä½•åœ¨ Mac ä¸Šä½¿ç”¨ [Conda](https://conda.io/docs/) å®‰è£… [GDAL](http://www.gdal.org) çš„è¯´æ˜ã€‚åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘è¦å†™è¿™ä¸ªæŒ‡å—ã€‚GDAL ä»£è¡¨â€œåœ°ç†ç©ºé—´æ•°æ®æŠ½è±¡åº“**ï¼Œç”±[å¼€æºåœ°ç†ç©ºé—´åŸºé‡‘ä¼š](http://www.osgeo.org)å‘å¸ƒã€‚å¯¹äº Python æ¥è¯´ï¼ŒGDAL åŒ…ä¹Ÿæ˜¯å’Œåä¸º`**osgeo**`çš„åŒ…ä¸€èµ·å‘å¸ƒçš„ã€‚ç¢°å·§çš„æ˜¯ï¼Œæˆ‘æ­£åœ¨åšçš„ä¸€ä¸ªé¡¹ç›®éœ€è¦è¿™ä¸¤æ ·ä¸œè¥¿ã€‚æˆ‘å¸Œæœ›å®ƒä»¬è¢«æ•´é½åœ°åŒ…è£…åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ã€‚**

**![](img/aa983f8662a4795d2711269cfb184fc1.png)**

**One Does Not Simply pip install gdal [Source](https://twitter.com/ocefpaf/status/753992589938860032)**

**æˆ‘å¼€å§‹å°è¯•ä½¿ç”¨ pip å’Œ virtual-envã€‚è¿™ä¸ªæ™¦æ¶©éš¾æ‡‚çš„æ“ä½œæ–¹æ³•(ä¹Ÿæ˜¯åª’ä½“ä¸Šçš„ç¬¬ä¸€ç¯‡å¸–å­ï¼)ç»è¿‡å‡ ä¸ªå°æ—¶çš„è°·æ­Œæœç´¢ï¼Œå¹¶è¯•å›¾è°ƒè¯•æˆ‘ä¸€è·¯ä¸Šé‡åˆ°çš„é”™è¯¯åï¼Œæ¥åˆ°ä½ é¢å‰ã€‚æœ€åï¼Œæˆ‘æ”¹å˜äº†ä¸»æ„ï¼Œå°è¯•äº†ä¸€äº›æ–°çš„ä¸œè¥¿ï¼Œæ¢æˆäº†åº·è¾¾ã€‚è¿™æ˜¯æˆ‘æ‰€æœ‰é—®é¢˜çš„è§£å†³åŠæ³•ã€‚å¥½å§ï¼Œé™¤äº†ä¸€äº›ï¼Œä½†æ˜¯æˆ‘ä¹Ÿä¿®å¥½äº†ã€‚**

**Conda å¾ˆæ£’ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåƒ pip ä¸€æ ·çš„åŒ…ç®¡ç†å™¨ï¼Œä½†å®ƒä¹Ÿåƒ virtual-env ä¸€æ ·ç®¡ç†æ‚¨çš„è™šæ‹Ÿç¯å¢ƒã€‚é™¤äº†è¿™ä¸¤ç§æ–¹å¼éƒ½åšå¾—æ›´å¥½ï¼Œè€Œä¸”ä½¿ç”¨èµ·æ¥å¾ˆæ„‰å¿«ã€‚å–„å¾…è‡ªå·±ï¼Œæ¢åº·è¾¾ã€‚**

**æˆ‘æƒ³è®©ä½ å…å—æˆ‘æ‰€ç»å†çš„éº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘å†™ä¸‹äº†ä»¥ä¸‹è¯´æ˜ã€‚**

## **ç¯å¢ƒ:**

**å…³äºæˆ‘å·¥ä½œç¯å¢ƒçš„ç®€çŸ­è¯´æ˜:**

> ***Mac OS 10 . 12 . 6 Sierra
> miniconda 2 for Python 2(Conda 4 . 3 . 30)*[*info*](https://conda.io/miniconda.html) *Python 2 . 7 . 14***
> 
> **å¯é€‰ python åŒ…:[*Jupyter ç¬”è®°æœ¬*](http://jupyter.org/install.html) *ï¼Œå®‰è£…æœ‰*`$ conda install jupyter`
> [*nb _ conda*](https://github.com/Anaconda-Platform/nb_conda)*ï¼Œä½¿å¾— Jupyter ä¸ Condaã€* `$ conda install nb_conda`ç©å¾—å¾ˆæ„‰å¿«**

**å¦‚æœæ‚¨åœ¨ä¸åŒçš„å¼€å‘ç¯å¢ƒä¸­å·¥ä½œï¼Œæ‚¨çš„æ”¶è·å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚**

**ç°åœ¨ï¼Œæˆ‘è‡ªå·±å‡ å°æ—¶å‰å°±éœ€è¦çš„è¯´æ˜â€¦**

# **å¦‚ä½•å®‰è£… GDALğŸŒä½¿ç”¨ CondağŸåœ¨ Mac ä¸ŠğŸ**

**æœ¬æ•™ç¨‹å‡è®¾æ‚¨å·²ç»å®‰è£…äº† Condaï¼Œå¹¶ä¸”å·²ç»åˆ›å»ºäº† Conda ç¯å¢ƒã€‚åˆ†åˆ«æŒ‡ç¤º[è¿™é‡Œ](https://conda.io/docs/user-guide/install/macos.html)å’Œ[è¿™é‡Œ](https://conda.io/docs/user-guide/getting-started.html#managing-environments)ã€‚**

## **æ­¥éª¤ 1:æ¿€æ´»æ‚¨çš„ Conda ç¯å¢ƒğŸš€**

**æ‰“å¼€**ç»ˆç«¯**ï¼Œè¿è¡Œ:**

```
$ source activate [yourEnvironmentName]
```

**å¯¹æˆ‘æ¥è¯´ï¼Œ[æ‚¨çš„ç¯å¢ƒåç§°] = `geoenv`ã€‚**

**![](img/0f8ba239c2c638c2062ce598d663ea06.png)**

**Screenshot. Weâ€™ve gone from the global shell to the Conda local environment that was just created.**

**(æˆ‘ä»¬å¯ä»¥ç”¨å‘½ä»¤`$ source deactivate`å–æ¶ˆæ¿€æ´»ã€‚)**

## **æ­¥éª¤ 2:å¥½ï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹å®‰è£… GDALã€‚ğŸ”§**

**ä»ç„¶åœ¨ç»ˆç«¯ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤:**

```
$ conda install gdal
```

**è¿™æ˜¯æˆ‘å¾—åˆ°çš„:**

**![](img/08e42077ba78826028b40a7e16abb52d.png)**

**Screenshot. Output from â€œconda install gdalâ€**

**å¤ªå¥½äº†ã€‚äº‹å®è¯æ˜ï¼Œä¸ºäº†è®© osgeo å­åŒ…å·¥ä½œï¼Œæˆ‘ä»¬å®é™…ä¸Šéœ€è¦ä¾èµ–é¡¹`**jpeg version 8**`ï¼Œè€Œä¸æ˜¯`**9**`ã€‚åœ¨è¿™ç¯‡æ–‡ç« çš„æœ«å°¾ï¼Œä½ å¯ä»¥åœ¨#è¯Šæ–­ä¸‹è¯»åˆ°æ›´å¤šå…³äºæˆ‘æ˜¯å¦‚ä½•å¾—å‡ºè¿™ä¸ªç»“è®ºçš„ã€‚**

**ç°åœ¨ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯è¿è¡Œè¿™ä¸ª:**

```
$ conda install -f jpeg=8
```

**â€œ-fâ€æ ‡å¿—å¼ºåˆ¶å®‰è£…(è¿™å®é™…ä¸Šæ˜¯ jpeg æ¨¡å—çš„é™çº§)ã€‚**

**![](img/faab988f759e1624ae1d3b77971138e6.png)**

**Screenshot. Install jpeg version 8 with Conda**

**å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨åº”è¯¥æœ‰ä¸€ä¸ª GDAL çš„å·¥ä½œç‰ˆæœ¬äº†ï¼æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ä»¥ç¡®ä¿ã€‚**

## **æ­¥éª¤ 3:æµ‹è¯•å®‰è£…ğŸ”**

**æ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œæˆ– Jupyter ç¬”è®°æœ¬ä¸­å®Œæˆè¿™é¡¹å·¥ä½œã€‚ç”±äºæˆ‘æƒ³ç¡®ä¿ gdal ä»¥åèƒ½åœ¨ Jupyter å·¥ä½œï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—åœ¨é‚£é‡Œæµ‹è¯•ã€‚**

**æ‰“å¼€æ–°çš„ Jupyter ç¬”è®°æœ¬ğŸ“™ï¼Œè¿”å›ç»ˆç«¯ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤:**

```
$ jupyter notebook
```

**æ­¤å‘½ä»¤å°†ä½¿ç”¨ Jupyter ç¬”è®°æœ¬æ–‡ä»¶æŸ¥çœ‹å™¨åœ¨æ‚¨çš„ internet æµè§ˆå™¨ä¸­æ‰“å¼€ä¸€ä¸ªæ–°é€‰é¡¹å¡ã€‚å¯¼èˆªåˆ°è¦ä¿å­˜ç¬”è®°æœ¬çš„ç›®å½•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³å¼€å§‹ä¸€ä¸ªæ–°çš„ç¬”è®°æœ¬ã€‚è½¬åˆ°å³ä¸Šè§’ï¼Œå•å‡»â€œæ–°å»ºâ€ã€‚**

**![](img/63a235b72afd73cab3b08f5087cc3f18.png)**

**Screenshot. Jupyter Notebook, creating a new notebook, I select â€œPython [conda env:geoenv]â€**

**ç¡®ä¿é€‰æ‹©æ‚¨ä¸€ç›´ä½¿ç”¨çš„ Conda ç¯å¢ƒä½œä¸º Python å†…æ ¸ã€‚**

**è®©æˆ‘ä»¬ç»§ç»­æµ‹è¯•å§ï¼åœ¨ç¬”è®°æœ¬ä¸­è¿è¡Œè¿™äº›å‘½ä»¤ã€‚**

```
import gdal
help(gdal)
```

**![](img/4bb1eec353d3e8325908bc1036484e9d.png)**

**Screenshot. Import gdal and get the help to make sure it works!**

**å¯¹ gdal çš„å¸®åŠ©èµ·ä½œç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡ºå‘å»æ¯”èµ›ã€‚**

```
import osgeo
help(osgeo)
```

**![](img/2db1864abbe2836a7a471264567fdd7c.png)**

**Screenshot. Import osgeo and run help(osgeo) to make sure it works!**

**æˆåŠŸï¼ğŸ¤—**

**æˆ‘ä»¬ç»ˆäºå®‰è£…äº† GDAL å’Œ osgeoã€‚ä¸€åˆ‡æ­£å¸¸(ç›®å‰)ã€‚å†™è¿™ç¯‡æœ‰ç‚¹é•¿çš„å¸–å­æ˜¯ä¸€ç§äº«å—ï¼Œå› ä¸ºè¿™ä¸ªé—®é¢˜è®©æˆ‘çº ç»“äº†æ— æ•°ä¸ªå°æ—¶ã€‚æˆ‘å¸Œæœ›èƒ½è®©ä½ å…é­åŒæ ·çš„å‘½è¿ã€‚æå‰æ„Ÿè°¢ä½ ä»¬çš„æŒå£°ğŸ‘ğŸ½å¦‚æœæœ‰ä»€ä¹ˆéœ€è¦ç¼–è¾‘æˆ–æ¾„æ¸…çš„åœ°æ–¹ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚è¯´å®Œï¼Œæˆ‘å°±è¦å’Œ`**networkx**`ä¸€èµ·æ¢ç´¢å›¾è¡¨äº†ï¼**

**å’Œâ¤ï¸ä¸€èµ·ï¼Œ**

**è²åˆ©æ™®**

**é™„è¨€**

## **#æ’°å†™è¿™ç¯‡æ–‡ç« çš„åŠ¨æœº**

**æˆ‘é€šå¸¸å–œæ¬¢åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥ä¿æŒäº‹æƒ…æœ‰æ¡ç†ã€‚é¦–å…ˆï¼Œæˆ‘å°è¯•åœ¨ python **virtual-env** ä¸­å®‰è£… GDALï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„å¤±è´¥ã€‚åœ¨ Windows å’Œ Ubuntu ä¸Šæœ‰å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„è¯´æ˜ï¼Œä½†æˆ‘æ— æ³•è®©å®ƒåœ¨ Mac ä¸Šå·¥ä½œã€‚è™šæ‹Ÿç¯å¢ƒæ›´åƒæ˜¯è™šæ‹Ÿæ•Œäººã€‚StackOverflow ä¸Šçš„ä¸€äº›äººå»ºè®®ä½¿ç”¨ [Conda](https://conda.io/docs/) æ¥ä»£æ›¿ã€‚ä¸ç®¡æ€æ ·ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›éšœç¢ï¼Œæ‰€ä»¥æˆ‘å†³å®šå‘å¸ƒè¿™äº›å¦‚ä½•åœ¨ Mac ä¸Šä½¿ç”¨ Python/Conda å®‰è£… GDAL çš„è¯´æ˜ã€‚äº²çˆ±çš„è¯»è€…ï¼Œæˆ‘å¸Œæœ›è¿™ä¸ªæŒ‡å—èƒ½ä¸ºä½ èŠ‚çœä¸€äº›æ—¶é—´ã€‚**

## **#æˆ‘ç”¨ GDAL åšä»€ä¹ˆ**

**æˆ‘éœ€è¦ GDAL æœ‰ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„åŸå› ã€‚å®ƒæ˜¯ [networkx](http://networkx.github.io) Python æ¨¡å—çš„`**read_shp()**`å‡½æ•°æ‰€å¿…éœ€çš„ï¼Œä¹Ÿæ˜¯å…¶ä¾èµ–é¡¹ã€‚è¯¥å‡½æ•°è¯»å…¥ ESRI shapefile(åœ°ç†ç©ºé—´æ•°æ®)å¹¶å°†å…¶è½¬æ¢ä¸ºç½‘ç»œ/å›¾å½¢å¯¹è±¡ã€‚å¾ˆæ˜æ˜¾ï¼Œä½ å¯èƒ½éœ€è¦ GDAL åšåˆ«çš„äº‹æƒ…ã€‚**

**ä¸ºäº†å®‰è£…ï¼Œæˆ‘é¦–å…ˆå°è¯•åœ¨ Python è™šæ‹Ÿç¯å¢ƒ(åˆå virtual-env)ä¸­ä½¿ç”¨`**pip install gdal**`ã€‚å¤±è´¥äº†ã€‚æˆ‘æƒ³ä½ å¯ä»¥è¯´è¿™åªæ˜¯ä¸€ä¸ªå°å°çš„æ¢¦æƒ³ï¼Œå”‰ã€‚æˆ–è€…å¯èƒ½ä¸å®‰è£…äº† QGIS via Kyngchaos æœ‰å…³ã€‚è¯¥å‘è¡Œç‰ˆåŒ…å«çš„ GDAL ä¸æ˜¯ Python åŒ…ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¡†æ¶ã€‚**

**ä¸ç®¡æ€æ ·ï¼Œåº•çº¿æ˜¯æˆ‘ä»ç„¶éœ€è¦ GDAL åœ¨ Python è™šæ‹Ÿç¯å¢ƒä¸­å·¥ä½œã€‚**

## **#è¯Šæ–­ Conda å®‰è£…é—®é¢˜:**

**å¯¹æˆ‘æ¥è¯´ï¼Œä½¿ç”¨ pip å°† GDAL å®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ˜¯ä¸å¯èƒ½çš„ã€‚æ‰€ä»¥æˆ‘æ‰æ¢äº†åº·è¾¾ã€‚**

**åœ¨ Conda ä¸­è¿è¡Œå®‰è£…æ—¶ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚ç®€å•åœ°ä»`**networkx**`è¿è¡Œ`read_shp`å‡½æ•°ä¼šç»™æˆ‘ä¸€ä¸ªä¸€èˆ¬æ€§é”™è¯¯ï¼Œå°±åƒåœ¨ virtual-env ä¸­ä¸€æ ·ã€‚**

> **I mportError: read_shp éœ€è¦ OGR:**

**![](img/9c0d362ac669936e4edd8f442460cd76.png)**

**Screenshot. Jupyter notebook. What happens when I try to run the command: G = nx.read_shp(â€˜file.shpâ€™)**

**åœ¨æˆªå›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°ä»£ç éœ€è¦`**from osgeo import ogr**` ï¼Œå®ƒå®é™…ä¸Šæ˜¯ GDAL æ¨¡å—çš„ä¸€éƒ¨åˆ†ã€‚**

**æ‰€ä»¥å½“æˆ‘ä»¬å°è¯•`**import gdal**`æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®é™…å‘ç”Ÿäº†ä»€ä¹ˆ:**

> **æœªåŠ è½½åº“:@rpath/libjpeg.8.dylib**

**![](img/a2d735cab053baba5987321a8956f1cf.png)**

**Error when I try to run import gdal. The library jpeg.8 is missing.**

**jpeg8 åº“æ²¡æœ‰åŠ è½½ã€‚ä¸ºäº†è°ƒæŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥åº·è¾¾å®‰è£…äº†å“ªäº›åŒ…:`**$ conda list**`**

**![](img/82029138ad5712e7c5bdc87835a41319.png)**

**Result of the **conda list** command. Sure enough, we have jpeg=9, rather than 8.**

**æ­¤å¤–ï¼Œå½“æˆ‘åªå¸è½½å¹¶é‡æ–°å®‰è£…`**gdal**`æ—¶ï¼Œäº‹å®ä¸Šå¾ˆæ˜æ˜¾ gdal æœ¬èº«å°† jpeg æ›´æ–°åˆ°äº†ç‰ˆæœ¬ 9ï¼Œåªæ˜¯åæ¥ä¸­æ–­äº†ã€‚**

**![](img/a6be229d945dbfa25d2d6c715b2ab9ab.png)**

**GDAL breaks itself. Or rather, GDAL breaks osgeo which itâ€™s bundled with(!)**

**ä¿®å¤æ–¹æ³•æ˜¯åœ¨å®‰è£… gdal åç®€å•åœ°å°† jpeg 9 é™çº§ä¸º jpeg 8ã€‚ä½ å¯ä»¥åœ¨ä¸Šè¿°#è¯´æ˜çš„ç¬¬ 3 æ­¥ä¸­æ‰¾åˆ°é…æ–¹ã€‚è°¢è°¢ï¼**

## **æˆ‘ä½¿ç”¨çš„æ¥æº:**

*   **egayer åœ¨ gdal GitHub çš„è¿™ä¸ªå¸–å­ä¸­çš„è¯„è®º**
*   **[â€œå®‰è£… python çš„ GDAL æœ‰é—®é¢˜â€](https://stackoverflow.com/questions/34408699/having-trouble-installing-gdal-for-python)**
*   **æˆ‘æ²¡æœ‰åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­åŒ…æ‹¬æˆ‘å¯¹ä»»ä½•ä¸â€œpip install GDALâ€æˆ–â€œGDAL python install MAC virtual-envâ€ç›¸å…³çš„ç–¯ç‹‚ã€è¯¦å°½çš„æœç´¢ã€‚å¦‚æœä½ æƒ³èµ°é‚£æ¡è·¯ï¼Œæ„¿ä¸Šå¸ä¿ä½‘ä½ ã€‚**